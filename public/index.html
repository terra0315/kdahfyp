<!DOCTYPE html>
<html lang="en">

<head>
    
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-DAH</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">

    <!-- font awesome cdn link  -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery-js/1.4.0/css/lightgallery.min.css">

    <link rel="stylesheet" href="https://unpkg.com/swiper@7/swiper-bundle.min.css" />

    <link rel="stylesheet" href="css/finance.css">

    <!-- Leaflet Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
        integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
        integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
        crossorigin=""></script>

    <!-- Add the new styles from user's code at the top of the style section -->
    <style>
        /* Custom variables for the website */
        :root {
            --primary: #3b8566; /* Main green */
            --primary-light: #4ea37f;
            --primary-dark: #2a6349;
            --accent: #d8a84e; /* Warm accent */
            --text-light: #f7f7f7;
            --text-dark: #333333;
            --bg-dark: #1a1a1a;
            --bg-light: #f5f5f5;
            --transition-speed: 0.3s;
            --container-width: 1200px;
            --header-height: 70px;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--bg-light);
        }

        /* Header styles - CONSOLIDATED VERSION */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            height: var(--header-height);
            background-color: #111111; /* Solid very dark background */
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.5);
            transition: all var(--transition-speed);
            transform: translateY(0);
        }

        .header.hidden {
            transform: translateY(-100%);
        }

        .header.scrolled {
            background-color: #111111;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.6);
        }

        /* Show header when user hovers near top of the page */
        .show-trigger {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 20px; /* Height of the trigger area */
            z-index: 999;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
            padding: 0 2rem;
            max-width: var(--container-width);
            margin: 0 auto;
            background-color: #111111; /* Ensure navbar has same background */
            width: 100%;
        }

        /* Logo styles */
        .nav-logo {
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        .logo-img {
            height: 40px;
            margin-right: 10px;
            border-radius: 8px;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-title {
            color: var(--primary-light);
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .logo-subtitle {
            color: var(--text-light);
            font-size: 0.75rem;
            opacity: 0.8;
            letter-spacing: 0.5px;
        }

        /* Navigation link styles */
        .nav-container {
            display: flex;
            align-items: center;
            height: 100%;
            background-color: #111111; /* Match header background */
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 1rem; /* Increased gap for better separation */
            transition: var(--transition-speed);
            background-color: #111111; /* Match header background */
            padding: 0; /* Reset padding */
            margin: 0; /* Reset margin */
        }
        
        .nav-menu li {
            position: relative;
            /* Remove complex animations that cause lag */
            opacity: 1;
        }
        
        /* Remove complex animations for children */
        .nav-menu li:nth-child(n) { 
            animation-delay: 0s; 
        }
        
        /* Remove vertical separators between menu items */
        .nav-menu li:not(:last-child)::after {
            display: none;
        }

        .nav-link {
            position: relative;
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            padding: 0.6rem 1.2rem; /* Increase padding for better hit area */
            border-radius: 4px;
            transition: all 0.2s ease; /* Faster transitions */
            z-index: 1;
            margin: 0;
            display: block; /* Ensure proper sizing */
            white-space: nowrap; /* Prevent text wrapping */
        }

        /* Simplify hover effect */
        .nav-link:hover {
            color: var(--primary-light);
            background-color: rgba(78, 163, 127, 0.1);
        }

        /* Simplify active state */
        .nav-link.active {
            color: var(--primary-light);
            background-color: rgba(78, 163, 127, 0.15);
        }
        
        /* Mobile menu button */
        .mobile-menu-btn {
            display: none;
            flex-direction: column;
            justify-content: space-between;
            width: 30px;
            height: 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            z-index: 10;
            transition: transform 0.2s ease; /* Faster transition */
        }

        @media (max-width: 992px) {
            .nav-separator {
                display: none;
            }
        }
        
        /* Remove animation delays that cause performance issues */
        /* 
        .nav-menu li:nth-child(2) { animation-delay: 0.3s; }
        .nav-menu li:nth-child(4) { animation-delay: 0.4s; }
        .nav-menu li:nth-child(6) { animation-delay: 0.5s; }
        .nav-menu li:nth-child(8) { animation-delay: 0.6s; }
        .nav-menu li:nth-child(10) { animation-delay: 0.7s; }
        .nav-menu li:nth-child(12) { animation-delay: 0.8s; }
        .nav-menu li:nth-child(14) { animation-delay: 0.9s; }
        */

        .nav-link {
            position: relative;
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            padding: 0.5rem 0.8rem;
            border-radius: 4px;
            transition: all var(--transition-speed);
            z-index: 1;
            margin: 0 0.2rem;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(78, 163, 127, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
            z-index: -1;
            border-radius: 4px;
        }
        
        .nav-link:hover {
            color: var(--primary-light);
            transform: translateY(-2px);
            text-shadow: 0 0 10px rgba(78, 163, 127, 0.3);
        }

        .nav-link:hover::before {
            transform: translateX(100%);
        }

        .nav-link:after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-light);
            transition: width var(--transition-speed);
        }

        .nav-link:hover:after {
            width: 80%;
        }

        /* Custom pulse animation for active link */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(78, 163, 127, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(78, 163, 127, 0); }
            100% { box-shadow: 0 0 0 0 rgba(78, 163, 127, 0); }
        }
        
        .nav-link.active {
            color: var(--primary-light);
            background-color: rgba(78, 163, 127, 0.15);
            box-shadow: 0 0 8px rgba(78, 163, 127, 0.3);
            transform: translateY(-1px);
        }
        
        .nav-link.active:after {
            width: 80%;
        }
        
        .nav-link.active::before {
            background: none;
        }
        
        /* Update responsive styles for separators */
        @media (max-width: 992px) {
            .mobile-menu-btn {
                display: flex;
            }

            .nav-menu {
                position: fixed;
                top: var(--header-height);
                right: -100%;
                flex-direction: column;
                background-color: #111111; /* Solid dark background */
                width: 100%;
                text-align: center;
                transition: 0.3s;
                box-shadow: 0 10px 27px rgba(0, 0, 0, 0.5);
                padding: 1.5rem 0;
                border-top: 1px solid var(--primary-dark);
                gap: 0;
                z-index: 999;
            }
            
            /* Remove separator styling on mobile */
            .nav-menu li:not(:last-child)::after {
                display: none;
            }

            .nav-menu.active {
                right: 0;
            }

            .nav-link {
                margin: 1rem 0;
                display: inline-block;
                width: 80%;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 0 1rem;
            }

            .navbar {
                padding: 0 1rem;
            }

            .logo-title {
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            .logo-img {
                height: 35px;
            }

            .logo-title {
                font-size: 1rem;
            }

            .logo-subtitle {
                font-size: 0.65rem;
            }
        }
        /* Rest of your existing styles continue below this */

        /* Base styles */
        body {
            font-family: 'Poppins', sans-serif;
        }

        /* Header styles */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background-color: rgba(0, 0, 0, 0.8);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar {
            width: 100%;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
        }

        .nav-left {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-right {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .nav-right .nav-link {
            background-color: #006400;
            padding: 0.5rem 1.2rem;
        }

        .nav-right .nav-link:hover {
            background-color: #008000;
            box-shadow: 0 4px 12px rgba(0, 100, 0, 0.2);
        }

        /* Home section styles */
        .homeID {
            padding-top: 70px;
            min-height: 650px;
            display: flex;
            align-items: center;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .homeID::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1;
        }

        .homeID .row {
            position: relative;
            z-index: 2;
            width: 100%;
        }

        /* Enhance the left column layout */
        .homeID .col-md-6 .content {
            padding: 30px;
            background: rgba(0, 0, 0, 0.65);
            border-radius: 15px;
            border: 1px solid rgba(0, 100, 0, 0.3);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        /* Make title more prominent */
        .kdah-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 4rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            background: linear-gradient(90deg, #006400, #00a000);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
        }

        .kdah-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #006400, #00a000);
            border-radius: 3px;
        }

        .kdah-subtitle {
            font-family: 'Poppins', sans-serif;
            font-size: 2.4rem;
            font-weight: 600;
            color: white;
            margin-bottom: 1.5rem;
            line-height: 1.3;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: 1px;
            position: relative;
            padding-left: 20px;
        }

        .kdah-subtitle::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 80%;
            background: linear-gradient(to bottom, #006400, #00a000);
            border-radius: 4px;
        }

        @keyframes titleGlow {
            0% {
                text-shadow: 0 0 10px rgba(0, 100, 0, 0.5);
            }
            100% {
                text-shadow: 0 0 20px rgba(0, 160, 0, 0.8);
            }
        }

        @media (max-width: 768px) {
            .kdah-title {
                font-size: 3rem;
            }

            .kdah-subtitle {
                font-size: 1.8rem;
                padding-left: 15px;
            }
        }

        /* Animated text styles */
        .animate-text {
            margin: 1.5rem 0;
            padding: 1rem 0;
            height: 2.5rem;
            overflow: hidden;
            position: relative;
        }

        .animate-text span {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transform: translateY(100%);
            transition: all 0.5s ease;
            font-size: 1.5rem;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .animate-text span.text-in {
            opacity: 1;
            transform: translateY(0);
        }

        .animate-text span.text-out {
            opacity: 0;
            transform: translateY(-100%);
        }

        /* Form styles */
        .forms-sample {
            margin-top: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-control {
            margin-bottom: 1.5rem !important;
        }

        /* Media queries */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                padding: 1rem;
            }

            .nav-left, .nav-right {
                flex-wrap: wrap;
                justify-content: center;
                gap: 0.5rem;
                width: 100%;
                text-align: center;
            }

            .nav-link {
                display: block;
                padding: 0.8rem;
            }

            .homeID {
                padding-top: 120px;
            }

            .kdah-title {
                font-size: 2.5rem;
            }

            .kdah-subtitle {
                font-size: 1.8rem;
            }

            .animate-text span {
                font-size: 1.2rem;
            }
        }

        /* Section spacing and styling */
        section {
            padding: 2rem 0;
            margin: 0;
            position: relative;
        }

        .homeID {
            padding-top: 70px;
            min-height: 70vh;
            display: flex;
            align-items: center;
            background-size: cover;
            background-position: center;
        }

        .content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .split_class {
            margin-top: -2rem; /* Reduce space at top */
        }

        /* Heading adjustments */
        .heading {
            margin-bottom: 1.5rem;
            position: relative;
            font-size: 2.5rem;
            text-align: center;
            padding-bottom: 15px;
        }

        .heading::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #006400, #00a000);
            border-radius: 3px;
        }

        /* Title and subtitle spacing */
        h3.kdah-title {
            padding-bottom: 2rem !important;
            margin: 0;
            color: white;
            font-size: 3.75rem;
        }

        h4.kdah-subtitle {
            color: white;
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            line-height: 1.3;
        }

        /* Animated text adjustments */
        .animate-text {
            margin: 1.5rem 0;
            padding: 1rem 0 !important;
        }

        /* Form styling */
        .forms-sample {
            margin-top: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        /* Select input styling */
        .form-control {
            margin-bottom: 1.5rem !important;
        }

        /* About section adjustments */
        .about {
            padding-top: 3rem;
        }

        .about .content {
            padding: 0 2rem;
        }

        .about p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        /* Map section adjustments */
        .c_finance {
            padding-top: 2rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .homeID {
                padding-top: 100px;
            }

            .split_class {
                margin-top: 0;
            }

            h3.kdah-title {
                padding-bottom: 1.5rem !important;
                font-size: 2rem;
            }

            h4.kdah-subtitle {
                font-size: 1.8rem;
            }
        }

        /* Add these new styles */
        .brand-logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #006400 !important;
            text-decoration: none;
            padding: 0.5rem 1rem;
            background-color: white;
            border-radius: 8px;
            margin-right: 2rem;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .brand-logo:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 100, 0, 0.2);
        }

        /* Adjust natural disasters section */
        .testimonials-carousel-wrap {
            max-width: 1600px;
            margin: auto;
            padding: 2rem 0;
        }

        /* Add spacing before Historical Cases */
        .section-spacer {
            height: 5rem;
            background-color: black;
        }

        /* Footer styles */
        .footer {
            background-color: #000;
            color: white;
            text-align: center;
            padding: 2rem 0;
            border-top: 1px solid #006400;
        }

        .footer p {
            margin: 0;
            font-size: 1.1rem;
            color: #888;
        }

        .footer .highlight {
            color: #006400;
            font-weight: bold;
        }

        /* Mobile menu button */
        .mobile-menu-btn {
            display: none;
            flex-direction: column;
            justify-content: space-between;
            width: 30px;
            height: 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            z-index: 10;
            transition: transform 0.3s ease;
        }
        
        .mobile-menu-btn:hover {
            transform: scale(1.1);
        }

        .mobile-menu-btn span {
            display: block;
            width: 100%;
            height: 2px;
            background-color: var(--text-light);
            transition: var(--transition-speed);
            transform-origin: 1px;
        }
        
        /* Add animation for nav links */
        @keyframes navLinkFade {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .nav-menu li {
            animation: navLinkFade 0.5s ease forwards;
            animation-delay: 0.2s;
            opacity: 0;
        }
        
        .nav-menu li:nth-child(2) { animation-delay: 0.3s; }
        .nav-menu li:nth-child(3) { animation-delay: 0.4s; }
        .nav-menu li:nth-child(4) { animation-delay: 0.5s; }
        .nav-menu li:nth-child(5) { animation-delay: 0.6s; }
        .nav-menu li:nth-child(6) { animation-delay: 0.7s; }
        .nav-menu li:nth-child(7) { animation-delay: 0.8s; }
        
        /* Logo hover effect */
        .nav-logo {
            transition: all var(--transition-speed);
        }
        
        .nav-logo:hover {
            transform: translateY(-2px);
        }
        
        .nav-logo:hover .logo-title {
            color: #5ab88e;
        }
        
        .logo-img {
            transition: all var(--transition-speed);
        }
        
        .nav-logo:hover .logo-img {
            transform: scale(1.05);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* Update responsive styles for separators */
        .service-tag {
            background: rgba(0, 100, 0, 0.2);
            border: 1px solid rgba(0, 100, 0, 0.3);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.9rem;
            color: #00a000;
            font-weight: bold;
        }
        
        .alert-contact {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            padding: 8px 12px;
            margin: 12px 0;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .alert-contact a {
            color: #3399ff;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        
        .alert-contact a:hover {
            color: #66bbff;
            text-decoration: underline;
        }
        
        .view-map-btn {
            align-self: flex-start;
            background: linear-gradient(90deg, #006400, #00a000);
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-block;
            margin-top: auto;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .view-map-btn:hover {
            background: linear-gradient(90deg, #00a000, #006400);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* Click to Play overlay */
        .click-to-play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 3;
            font-size: 1.2rem;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
            cursor: pointer;
            border-radius: 12px 12px 0 0;
        }

        .video-thumbnail:hover .click-to-play-overlay {
            opacity: 1;
        }

        /* Video Modal Styles */
        .video-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            overflow: auto;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .video-modal.active {
            display: block;
            opacity: 1;
        }

        .video-modal-content {
            position: relative;
            background-color: #1c2d3b;
            margin: 5% auto;
            width: 80%;
            max-width: 900px;
            border-radius: 12px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
            color: white;
            overflow: hidden;
            animation: modalFadeIn 0.4s;
        }

        @keyframes modalFadeIn {
            from {transform: translateY(-50px); opacity: 0;}
            to {transform: translateY(0); opacity: 1;}
        }

        .video-modal-header {
            padding: 15px 20px;
            background-color: #0a1520;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .video-modal-header h3 {
            margin: 0;
            color: white;
            font-size: 1.3rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: #ccc;
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.3s ease;
            padding: 0;
            margin-left: 15px;
            line-height: 1;
        }

        .close-modal:hover {
            color: white;
        }

        .video-modal-body {
            padding: 0;
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            overflow: hidden;
        }

        #modal-video-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .video-modal-footer {
            padding: 15px 20px;
            background-color: #0a1520;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .accessibility-controls {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 15px;
        }

        .playback-speed {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #ccc;
        }

        #playback-speed-select {
            background-color: #333;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 8px;
            cursor: pointer;
        }

        #playback-speed-select:hover {
            background-color: #444;
        }

        #playback-speed-select:focus {
            outline: 2px solid #00a000;
            outline-offset: 2px;
        }

        @media screen and (max-width: 767px) {
            .video-modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .video-modal-header h3 {
                font-size: 1.1rem;
            }
            
            .accessibility-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .click-to-play-overlay {
                font-size: 1rem;
                opacity: 1; /* Always visible on mobile */
                background-color: rgba(0, 0, 0, 0.4);
            }
        }

        @media (hover: none) {
            .click-to-play-overlay {
                opacity: 1; /* Always visible on touch devices */
                background-color: rgba(0, 0, 0, 0.4);
            }
        }

        /* Focus styles for accessibility */
        .click-to-play-overlay:focus,
        .close-modal:focus,
        #playback-speed-select:focus {
            outline: 2px solid #00a000;
            outline-offset: 2px;
        }

        /* Make video thumb accessible via keyboard */
        .video-thumbnail {
            position: relative;
            overflow: hidden;
            border-radius: 12px 12px 0 0;
            height: 180px;
            cursor: pointer; /* Add cursor pointer to indicate clickable */
            outline: none; /* Remove default focus outline */
        }

        .video-thumbnail:focus-within {
            box-shadow: 0 0 0 3px #006400;
        }

        @media screen and (max-width: 576px) {
            .video-modal-content {
                margin: 15% auto;
            }
        }
    </style>

    <script type="importmap">
    {
        "imports":{
            "three": "./build/three.module.js"
        }
    }
</script>

<!-- Add YouTube iframe API -->
<script src="https://www.youtube.com/iframe_api"></script>

<!-- Add custom script for enhancing navigation animations -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add active class to section in viewport on page load
        function setActiveOnLoad() {
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');
            
            let currentSection = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (window.scrollY >= (sectionTop - 150)) {
                    currentSection = section.getAttribute('id');
                }
            });
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${currentSection}`) {
                    link.classList.add('active');
                }
            });
        }
        
        // Call the function on load
        setActiveOnLoad();
    });
</script>

<!-- Override styles to fix navigation bar issues -->
<style>
    /* Override header styles with solid background */
    .header {
        background-color: #111111 !important;
        box-shadow: 0 3px 15px rgba(0, 0, 0, 0.5) !important;
    }
    
    .navbar {
        background-color: #111111 !important;
    }
    
    .nav-container {
        background-color: #111111 !important;
    }
    
    .nav-menu {
        background-color: #111111 !important;
        gap: 1.5rem !important; /* More spacing between items */
    }
    
    /* Fix navigation link styling */
    .nav-link {
        margin: 0 !important;
        padding: 0.7rem 1.2rem !important;
        background-color: transparent !important;
        transition: all 0.2s ease !important;
        display: block !important;
        white-space: nowrap !important;
        position: relative !important;
        /* Fix z-index issues */
        z-index: 1 !important;
    }
    
    /* Disable complex animations */
    .nav-link::before, 
    .nav-link::after {
        display: none !important;
    }
    
    .nav-link:hover {
        background-color: rgba(78, 163, 127, 0.15) !important;
        color: #5ab88e !important;
        transform: translateY(0) !important; /* Remove movement that could cause issues */
    }
    
    .nav-link.active {
        background-color: rgba(78, 163, 127, 0.2) !important;
        color: #5ab88e !important;
        font-weight: 600 !important;
        box-shadow: none !important; /* Remove shadow effects */
    }
    
    /* Remove all animations from nav items */
    .nav-menu li {
        animation: none !important;
        opacity: 1 !important;
    }
    
    /* Remove all after elements that might create lines */
    .nav-menu li::after {
        display: none !important;
    }

</style>

</head>

<body>

    <!-- header section starts  -->
    <header class="header">
        <nav class="navbar">
            <a href="#home" class="nav-logo">
                <img src="/images/bg7.png" alt="K-DAH Logo" class="logo-img">
                <div class="logo-text">
                    <span class="logo-title">K-DAH</span>
                    <span class="logo-subtitle">Klang Disaster Awareness Hub</span>
                </div>
            </a>

            <div class="nav-container">
                <ul class="nav-menu">
                    <li><a href="#home" class="nav-link active">Home</a></li>
                    <li><a href="#about" class="nav-link">Introduction</a></li>
                    <li><a href="#c_finance" class="nav-link">Map</a></li>
                    <li><a href="#p_finance" class="nav-link">Natural Disasters</a></li>
                    <li><a href="#g_finance" class="nav-link">Disaster History</a></li>
                    <li><a href="#contribute" class="nav-link">Contribute</a></li>
                    <li><a href="/games/game.html" target="_blank" class="nav-link">Games</a></li>
                </ul>

                <button class="mobile-menu-btn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>
    </header>
    <!-- header section ends -->

    <!-- JavaScript for the header -->
    <script>
        // Mobile menu toggle
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const navMenu = document.querySelector('.nav-menu');
            const navLinks = document.querySelectorAll('.nav-link');
            
            // Mobile menu toggle
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                    
                    // Toggle hamburger animation with simpler transformation
                    const spans = this.querySelectorAll('span');
                    if (navMenu.classList.contains('active')) {
                        spans[0].style.transform = 'rotate(45deg)';
                        spans[1].style.opacity = '0';
                        spans[2].style.transform = 'rotate(-45deg)';
                    } else {
                        spans[0].style.transform = 'rotate(0)';
                        spans[1].style.opacity = '1';
                        spans[2].style.transform = 'rotate(0)';
                    }
                });
            }
            
            // Header scroll effect - simplified
            let lastScrollTop = 0;
            window.addEventListener('scroll', function() {
                const header = document.querySelector('.header');
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                if (scrollTop > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
                
                lastScrollTop = scrollTop;
            }, { passive: true }); // Add passive flag for better performance
            
            // Improved click handling for nav links
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    // Only for links that are not external (i.e., don't have target="_blank")
                    if (!link.hasAttribute('target')) {
                        // Remove active class from all links
                        navLinks.forEach(otherLink => otherLink.classList.remove('active'));
                        
                        // Add active class to clicked link
                        link.classList.add('active');
                        
                        // Close mobile menu if open
                        if (navMenu.classList.contains('active')) {
                            navMenu.classList.remove('active');
                            const spans = mobileMenuBtn.querySelectorAll('span');
                            spans[0].style.transform = 'rotate(0)';
                            spans[1].style.opacity = '1';
                            spans[2].style.transform = 'rotate(0)';
                        }
                    }
                });
            });
            
            // Set active link based on scroll position - optimized with throttling
            let isScrolling = false;
            window.addEventListener('scroll', function() {
                if (!isScrolling) {
                    isScrolling = true;
                    
                    // Use requestAnimationFrame for better performance
                    window.requestAnimationFrame(function() {
                        const sections = document.querySelectorAll('section');
                        
                        let currentSection = '';
                        sections.forEach(section => {
                            const sectionTop = section.offsetTop;
                            const sectionHeight = section.clientHeight;
                            
                            if (window.scrollY >= (sectionTop - 150)) {
                                currentSection = section.getAttribute('id');
                            }
                        });
                        
                        navLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === `#${currentSection}`) {
                                link.classList.add('active');
                            }
                        });
                        
                        isScrolling = false;
                    });
                }
            }, { passive: true }); // Add passive flag for better performance
        });
    </script>

    <!-- home section starts  -->
    <section class="homeID" id="home" style="background-image: url(/images/bg19.jpg);">
        <div class="container">
            <!-- Header with title and form -->
            <div class="main-header">
                <h3 class="kdah-title">K-DAH</h3>
                        <p class="animate-text">
                            <span>Map</span>
                            <span>Chatbot</span>
                            <span>Forums</span>
                            <span>Education</span>
                            <span>Resources</span>
                        </p>

                        <form class="forms-sample" action="/" method="post">
                            <div class="form-group row">
                        <div class="col-sm-12">
                                    <select class="form-control" id="inputState" onchange="myr2()"
                                style="color: black; width: 100%; max-width: 500px; height: 4rem; font-size: 1.5rem; border-radius: 1rem; border: 2px solid #006400; margin-bottom: 1.5rem; box-shadow: 0 4px 10px rgba(0, 100, 0, 0.2);">
                                        <option value="SelectState">Select Area</option>
                                        <option value="Klang Central">Klang Central</option>
                                        <option value="Bandar Puteri">Bandar Puteri</option>
                                        <option value="Kapar">Kapar</option>
                                        <option value="Pelabuhan Klang">Pelabuhan Klang</option>
                                        <option value="Taman Berkeley">Taman Berkeley</option>
                                        <option value="Bukit Raja">Bukit Raja</option>
                                        <option value="Telok Gadong">Telok Gadong</option>
                                        <option value="Bandar Klang">Bandar Klang</option>
                                        <option value="Taman Sri Andalas">Taman Sri Andalas</option>
                                        <option value="Pandamaran">Pandamaran</option>
                                        <option value="Klang Utara">Klang Utara</option>
                                        <option value="Klang Selatan">Klang Selatan</option>
                                        <option value="Bandar Botanic">Bandar Botanic</option>
                                        <option value="Bandar Sentosa">Bandar Sentosa</option>
                                        <option value="Bandar Bukit Tinggi">Bandar Bukit Tinggi</option>
                                    </select>
                                </div>
                            </div>
                            <script>
                                function myr2() {
                                    var x2 = document.getElementById("inputState");
                                    var i2 = x2.selectedIndex;
                                    var rr2 = x2.options[i2].text;
                                    console.log(rr2);
                            var txt2 = document.getElementById("ttid2").value = rr2
                                }
                            </script>

                            <button class="btn btn-gradient-primary me-2">Click Here!</button>

                            <input type="text" name="n33" placeholder="2nd numm" id="ttid2"
                                style="opacity: 0;visibility: hidden;">
                        </form>

                <!-- Add text animation script -->
                        <script>
                    document.addEventListener('DOMContentLoaded', function() {
                            const txts = document.querySelector(".animate-text").children,
                                txtsLen = txts.length;
                            let index = 0;
                            const textInTimer = 1500,  //Speed
                                textOutTimer = 1300;

                            function animateText() {
                                for (let i = 0; i < txtsLen; i++) {
                                    txts[i].classList.remove("text-in", "text-out");
                                }
                                txts[index].classList.add("text-in");

                                setTimeout(function () {
                                    txts[index].classList.add("text-out");
                                }, textOutTimer)

                                setTimeout(function () {
                                    if (index == txtsLen - 1) {
                                        index = 0;
                                    }
                                    else {
                                        index++;
                                    }
                                    animateText();
                                }, textInTimer);
                            }

                        animateText();
                    });
                        </script>
            </div>

            <!-- Alerts Section - Now below the form -->
            <div class="news-alerts-section">
                <div class="news-alerts-card">
                    <div class="news-alerts-header">
                        <h3>Latest Alerts <span class="pulse-dot"></span></h3>
                        <div class="news-controls">
                            <button class="alert-control-btn prev" aria-label="Previous alert"><i class="fas fa-chevron-left"></i></button>
                            <button class="alert-control-btn next" aria-label="Next alert"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                    
                    <div class="news-alerts-slider">
                        <!-- Alert 1: Klang Central - Very High Risk -->
                        <div class="alert-item active">
                            <div class="alert-badge urgent">Urgent</div>
                            <h4 class="alert-title">Flash Flood Warning: Klang Central</h4>
                            <p class="alert-time"><i class="far fa-clock"></i> 1 hour ago</p>
                            <p class="alert-description">Severe flooding reported near Hospital Tengku Ampuan Rahimah. Very high risk level declared. Evacuation recommended for low-lying areas.</p>
                            <div class="affected-areas">
                                <span class="area-tag">Klang Central</span>
                                <span class="area-tag risk-tag">Very High Risk</span>
                            </div>
                            <div class="alert-contact">
                                <i class="fas fa-phone-alt"></i> Emergency: <a href="tel:999">999</a> | Hospital: <a href="tel:03-3372-3333">03-3372-3333</a>
                            </div>
                            <button data-area="Klang Central" class="view-map-btn" onClick="viewAlertOnMap(this)">View on Map</button>
                        </div>
                        
                        <!-- Alert 2: Pelabuhan Klang - Very High Risk -->
                        <div class="alert-item">
                            <div class="alert-badge urgent">Urgent</div>
                            <h4 class="alert-title">Coastal Flooding: Pelabuhan Klang</h4>
                            <p class="alert-time"><i class="far fa-clock"></i> 3 hours ago</p>
                            <p class="alert-description">Rising water levels at Port Klang coast. Maritime operations suspended. Residents advised to move to designated safe zones.</p>
                            <div class="affected-areas">
                                <span class="area-tag">Pelabuhan Klang</span>
                                <span class="area-tag risk-tag">Very High Risk</span>
                            </div>
                            <div class="alert-contact">
                                <i class="fas fa-phone-alt"></i> Fire & Rescue: <a href="tel:994">994</a> | Police: <a href="tel:03-3167-7222">03-3167-7222</a>
                            </div>
                            <button data-area="Pelabuhan Klang" class="view-map-btn" onClick="viewAlertOnMap(this)">View on Map</button>
                    </div>

                        <!-- Alert 3: Kapar - Medium Risk -->
                        <div class="alert-item">
                            <div class="alert-badge warning">Warning</div>
                            <h4 class="alert-title">Weather Advisory: Kapar</h4>
                            <p class="alert-time"><i class="far fa-clock"></i> 5 hours ago</p>
                            <p class="alert-description">Moderate rainfall expected to continue in Kapar region. Residents should monitor water levels and prepare for possible evacuation.</p>
                            <div class="affected-areas">
                                <span class="area-tag">Kapar</span>
                                <span class="area-tag risk-tag-medium">Medium Risk</span>
                            </div>
                            <div class="alert-contact">
                                <i class="fas fa-phone-alt"></i> Community Center: <a href="tel:03-3250-5333">03-3250-5333</a>
                            </div>
                            <button data-area="Kapar" class="view-map-btn" onClick="viewAlertOnMap(this)">View on Map</button>
                        </div>
                        
                        <!-- Alert 4: Taman Berkeley - Low Risk -->
                        <div class="alert-item">
                            <div class="alert-badge notice">Notice</div>
                            <h4 class="alert-title">Road Closure: Taman Berkeley</h4>
                            <p class="alert-time"><i class="far fa-clock"></i> 1 day ago</p>
                            <p class="alert-description">Berkeley Medical Center remains open with emergency services. Minor flooding reported on Jalan Anggerik. Use alternative routes.</p>
                            <div class="affected-areas">
                                <span class="area-tag">Taman Berkeley</span>
                                <span class="area-tag risk-tag-low">Low Risk</span>
                            </div>
                            <div class="alert-contact">
                                <i class="fas fa-phone-alt"></i> Medical Center: <a href="tel:03-3323-7333">03-3323-7333</a>
                            </div>
                            <button data-area="Taman Berkeley" class="view-map-btn" onClick="viewAlertOnMap(this)">View on Map</button>
                        </div>
                        
                        <!-- Alert 5: Bandar Puteri - Emergency Services -->
                        <div class="alert-item">
                            <div class="alert-badge info">Update</div>
                            <h4 class="alert-title">Emergency Services: Bandar Puteri</h4>
                            <p class="alert-time"><i class="far fa-clock"></i> 2 days ago</p>
                            <p class="alert-description">Bandar Puteri Flood Relief Center now open at full capacity. Medical services and supplies available for affected residents.</p>
                            <div class="affected-areas">
                                <span class="area-tag">Bandar Puteri</span>
                                <span class="area-tag service-tag">Relief Center</span>
                            </div>
                            <div class="alert-contact">
                                <i class="fas fa-phone-alt"></i> Relief Center: <a href="tel:03-3169-5333">03-3169-5333</a>
                            </div>
                            <button data-area="Bandar Puteri" class="view-map-btn" onClick="viewAlertOnMap(this)">View on Map</button>
                </div>
            </div>

                    <div class="alert-indicators">
                        <span class="indicator active" data-index="0"></span>
                        <span class="indicator" data-index="1"></span>
                        <span class="indicator" data-index="2"></span>
                        <span class="indicator" data-index="3"></span>
                        <span class="indicator" data-index="4"></span>
            </div>
        </div>
            </div>
        </div>
    </section>

    <!-- Add CSS for the News Alerts section -->
    <style>
        /* Home section layout */
        .homeID {
            padding-top: 70px;
            min-height: 700px;
            display: flex;
            align-items: center;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .homeID::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1;
        }

        .homeID .container {
            position: relative;
            z-index: 2;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 15px;
        }

        /* Main header styles */
        .main-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .kdah-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 4rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            background: linear-gradient(90deg, #006400, #00a000);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
        }

        .kdah-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #006400, #00a000);
            border-radius: 3px;
        }

        .forms-sample {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        .btn {
            background: linear-gradient(180deg, rgba(52, 183, 89, 0.15) 0%, rgba(46, 164, 79, 0) 100%), #2ea44f !important;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        /* News Alerts Section */
        .news-alerts-section {
            margin: 20px auto;
            max-width: 900px;
        }

        /* News Alerts Card Styling */
        .news-alerts-card {
            background: rgba(0, 0, 0, 0.75);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 100, 0, 0.3);
            display: flex;
            flex-direction: column;
        }
        
        .news-alerts-header {
            background: linear-gradient(90deg, #006400, #00a000);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .news-alerts-header h3 {
            color: white;
            margin: 0;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pulse-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            background-color: #ff3333;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 51, 51, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 51, 51, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 51, 51, 0);
            }
        }
        
        .news-controls {
            display: flex;
            gap: 10px;
        }
        
        .alert-control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .alert-control-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.1);
        }
        
        .news-alerts-slider {
            flex: 1;
            position: relative;
            overflow: hidden;
            min-height: 300px;
        }
        
        .alert-item {
            padding: 20px;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s;
            color: white;
            display: flex;
            flex-direction: column;
        }
        
        .alert-item.active {
            opacity: 1;
            visibility: visible;
        }
        
        .alert-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 10px;
            align-self: flex-start;
        }
        
        .alert-badge.urgent {
            background-color: #e63900;
            color: white;
        }
        
        .alert-badge.warning {
            background-color: #ff9900;
            color: white;
        }
        
        .alert-badge.notice {
            background-color: #3399ff;
            color: white;
        }
        
        .alert-badge.info {
            background-color: #006400;
            color: white;
        }
        
        .alert-title {
            font-size: 1.8rem;
            margin: 0 0 10px 0;
            color: white;
        }
        
        .alert-time {
            font-size: 0.9rem;
            color: #ccc;
            margin-bottom: 15px;
        }
        
        .alert-description {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
            flex-grow: 1;
        }
        
        .affected-areas {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .area-tag {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .risk-tag {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.3);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #ff3333;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .risk-tag-medium {
            background: rgba(255, 165, 0, 0.2);
            border: 1px solid rgba(255, 165, 0, 0.3);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #ffa500;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .risk-tag-low {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.3);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #00ff00;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .service-tag {
            background: rgba(0, 100, 0, 0.2);
            border: 1px solid rgba(0, 100, 0, 0.3);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #00a000;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .alert-contact {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            padding: 8px 12px;
            margin: 12px 0;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .alert-contact a {
            color: #3399ff;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        
        .alert-contact a:hover {
            color: #66bbff;
            text-decoration: underline;
        }
        
        .view-map-btn {
            align-self: flex-start;
            background: linear-gradient(90deg, #006400, #00a000);
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-block;
            margin-top: auto;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .view-map-btn:hover {
            background: linear-gradient(90deg, #00a000, #006400);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .alert-indicators {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .indicator.active {
            background: #00a000;
            transform: scale(1.2);
        }
        
        
    </style>

    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- home section ends -->

<section class="about" id="about">
    <div class="container">
        <h1 class="heading">Welcome to K-DAH: Your Klang Disaster Awareness Hub</h1>
        <div class="about-intro">
            <h3>Empowering Klang with Real-Time Disaster Information and Community Support</h3>
            <p>In the face of potential natural disasters in the Klang region, staying informed and prepared is paramount. K-DAH (Klang - Disaster Awareness Hub) is a dedicated interactive web platform meticulously designed to serve as your central resource for enhancing public awareness, promoting safety, and fostering community resilience.</p>
        </div>
        
        <div class="features-grid">
            <!-- Feature 1: Interactive Map -->
            <div class="feature-card" data-aos="fade-up" data-aos-delay="100">
                <div class="feature-icon">
                    <i class="fas fa-map-marked-alt"></i>
                </div>
                <div class="feature-content">
                    <h4>Interactive Map</h4>
                    <p>Visualize active <span class="risk-zone">Risk Zones</span> and accessible <span class="safe-zone">Safe Zones</span> across Klang with our dynamic GIS map. Quickly identify areas of concern, locate shelters, and view evacuation routes in real-time.</p>
                </div>
            </div>
            
            <!-- Feature 2: Hazard Information -->
            <div class="feature-card" data-aos="fade-up" data-aos-delay="200">
                <div class="feature-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="feature-content">
                    <h4>Hazard Information</h4>
                    <p>Access comprehensive details about potential threats in your area, including hazard type, severity levels, and essential safety measures. Stay informed with timely alerts and location-specific risk assessments.</p>
                </div>
            </div>
            
            <!-- Feature 3: Historical Cases -->
            <div class="feature-card" data-aos="fade-up" data-aos-delay="300">
                <div class="feature-icon">
                    <i class="fas fa-history"></i>
                </div>
                <div class="feature-content">
                    <h4>Historical Cases</h4>
                    <p>Learn from past events through our detailed archive of historical disaster cases in Klang. Understand patterns, impacts, and response strategies to better prepare for potential future scenarios.</p>
                </div>
            </div>
            
            <!-- Feature 4: AI Chatbot -->
            <div class="feature-card" data-aos="fade-up" data-aos-delay="400">
                <div class="feature-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="feature-content">
                    <h4>AI Chatbot</h4>
                    <p>Get immediate answers to your questions with our intelligent <span class="chatbot">AI-powered Chatbot</span>. Available 24/7 to provide guidance on disaster preparedness, safety procedures, and emergency resources.</p>
                </div>
            </div>
            
            <!-- Feature 5: Community Forums -->
            <div class="feature-card" data-aos="fade-up" data-aos-delay="500">
                <div class="feature-icon">
                    <i class="fas fa-gamepad"></i>
                </div>
                <div class="feature-content">
                    <h4>Minigames</h4>
                    <p>Test your disaster preparedness skills with our <span class="safety-symbol-match-challenge">Safety Symbol Match Challenge</span>. Try matching the emergency safety symbols with their correct meanings to sharpen your knowledge in a fun, interactive way. Designed to engage all age groups, this game helps raise awareness about crucial safety indicators during disasters in Klang.</p>
                </div>
            </div>
            
            <!-- Feature 6: Contribution Tools -->
            <div class="feature-card" data-aos="fade-up" data-aos-delay="600">
                <div class="feature-icon">
                    <i class="fas fa-hands-helping"></i>
                </div>
                <div class="feature-content">
                    <h4>Contribution Tools</h4>
                    <p>Make a difference in your community through our integrated contribution platform. Report incidents, provide feedback, donate to relief efforts, and volunteer for local emergency response initiatives.</p>
                </div>
            </div>
        </div>
        
        <div class="about-conclusion" data-aos="fade-up" data-aos-delay="700">
            <h4>Our Commitment to a Safer Klang</h4>
            <p>K-DAH is more than just a website; it's a commitment to the safety and well-being of every resident in Klang. We are continuously working to enhance our platform with the latest data, innovative tools, and valuable community resources. Join us in building a well-informed, resilient, and connected Klang community, ready to face any challenge that may come our way.</p>
        </div>
    </div>
</section>

<style>
    .about {
        background-color: #000000;
        padding: 80px 0;
        overflow: hidden;
        position: relative;
    }
    
    .about::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at center, rgba(0,100,0,0.1) 0%, rgba(0,0,0,0) 70%);
        pointer-events: none;
    }
    
    .about .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        position: relative;
        z-index: 2;
    }
    
    .about .heading {
        color: #f0f0f0;
        font-size: 2.5rem;
        text-align: center;
        margin-bottom: 30px;
        position: relative;
        padding-bottom: 15px;
    }
    
    .about .heading::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 3px;
        background: linear-gradient(90deg, #006400, #00a000);
        border-radius: 3px;
    }
    
    .about-intro {
        text-align: center;
        max-width: 900px;
        margin: 0 auto 60px;
    }
    
    .about-intro h3 {
        color: #e0e0e0;
        margin-bottom: 20px;
        font-size: 1.8rem;
        font-weight: 600;
    }
    
    .about-intro p {
        color: #ccc;
        line-height: 1.7;
        font-size: 1.1rem;
    }
    
    .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 30px;
        margin-bottom: 60px;
    }
    
    .feature-card {
        background: rgba(20, 20, 20, 0.6);
        border-radius: 12px;
        padding: 30px;
        transition: all 0.3s ease;
        border: 1px solid rgba(50, 50, 50, 0.5);
        display: flex;
        flex-direction: column;
        height: 100%;
        overflow: hidden;
        position: relative;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }
    
    .feature-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 0;
        background: linear-gradient(to bottom, #006400, transparent);
        transition: height 0.5s ease;
    }
    
    .feature-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        background: rgba(25, 25, 25, 0.8);
    }
    
    .feature-card:hover::before {
        height: 100%;
    }
    
    .feature-icon {
        margin-bottom: 20px;
        width: 60px;
        height: 60px;
        background: rgba(0, 100, 0, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .feature-card:hover .feature-icon {
        background: rgba(0, 100, 0, 0.4);
        transform: scale(1.1);
    }
    
    .feature-icon i {
        font-size: 1.8rem;
        color: #4ea37f;
        transition: all 0.3s ease;
    }
    
    .feature-card:hover .feature-icon i {
        color: #66cc99;
    }
    
    .feature-content h4 {
        color: #e0e0e0;
        margin-bottom: 15px;
        font-size: 1.4rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .feature-card:hover .feature-content h4 {
        color: #66cc99;
    }
    
    .feature-content p {
        color: #bbb;
        line-height: 1.6;
        font-size: 1rem;
        margin: 0;
    }
    
    .about-conclusion {
        text-align: center;
        max-width: 900px;
        margin: 0 auto;
        padding: 30px;
        background: rgba(20, 20, 20, 0.6);
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(50, 50, 50, 0.5);
    }
    
    .about-conclusion h4 {
        color: #e0e0e0;
        margin-bottom: 15px;
        font-size: 1.6rem;
        font-weight: 600;
    }
    
    .about-conclusion p {
        color: #bbb;
        line-height: 1.7;
        font-size: 1.1rem;
        margin: 0;
    }
    
    .risk-zone {
        color: #ff4d4d;
        font-weight: bold;
    }
    
    .safe-zone {
        color: #66cc99;
        font-weight: bold;
    }
    
    .chatbot {
        color: #3399ff;
        font-weight: bold;
    }
    
    .safety-symbol-match-challenge {
        color: #ff9933;
        font-weight: bold;
    }
    
    /* Responsive adjustments */
    @media screen and (max-width: 1200px) {
        .features-grid {
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }
    }
    
    @media screen and (max-width: 768px) {
        .about {
            padding: 60px 0;
        }
        
        .about .heading {
            font-size: 2rem;
        }
        
        .about-intro h3 {
            font-size: 1.5rem;
        }
        
        .features-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        .feature-card {
            padding: 25px;
        }
        
        .about-conclusion {
            padding: 25px;
        }
        
        .about-conclusion h4 {
            font-size: 1.4rem;
        }
    }
    
    @media screen and (max-width: 480px) {
        .about {
            padding: 40px 0;
        }
        
        .about .heading {
            font-size: 1.8rem;
        }
        
        .about-intro h3 {
            font-size: 1.3rem;
        }
        
        .feature-content h4 {
            font-size: 1.2rem;
        }
        
        .feature-content p, 
        .about-intro p, 
        .about-conclusion p {
            font-size: 0.95rem;
        }
    }
</style>

<!-- Add AOS (Animate On Scroll) library for animations -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize AOS animation library
        AOS.init({
            duration: 800,
            easing: 'ease-out',
            once: true
        });
    });
</script>

    <section class="c_finance" id="c_finance" style="background-color: black;">
        <div class="content">
            <h1 class="heading" style="color: white;">Interactive Map</h1>
            
            <!-- Area Selection -->
            <div class="form-group row" style="margin-bottom: 2rem;">
                <div class="col-sm-9">
                    <select class="form-control" id="areaSelector" onchange="updateSelectedArea(this.value)"
                        style="color: black; width: 40rem; height: 4rem; font-size: 1.5rem; border-radius: 1rem; border: 2px solid #9966ff;">
                        <option value="SelectState">Select Area</option>
                        <option value="Klang Central">Klang Central</option>
                        <option value="Bandar Puteri">Bandar Puteri</option>
                        <option value="Kapar">Kapar</option>
                        <option value="Pelabuhan Klang">Pelabuhan Klang</option>
                        <option value="Taman Berkeley">Taman Berkeley</option>
                        <option value="Bukit Raja">Bukit Raja</option>
                        <option value="Telok Gadong">Telok Gadong</option>
                        <option value="Bandar Klang">Bandar Klang</option>
                        <option value="Taman Sri Andalas">Taman Sri Andalas</option>
                        <option value="Pandamaran">Pandamaran</option>
                        <option value="Klang Utara">Klang Utara</option>
                        <option value="Klang Selatan">Klang Selatan</option>
                        <option value="Bandar Botanic">Bandar Botanic</option>
                        <option value="Bandar Sentosa">Bandar Sentosa</option>
                        <option value="Bandar Bukit Tinggi">Bandar Bukit Tinggi</option>
                        <!-- Add more areas as needed -->
                    </select>
            </div>
        </div>

            <!-- Area Information Panel -->
            <div id="areaInfoPanel" class="area-info" style="background: rgba(0, 0, 0, 0.8); padding: 2rem; border-radius: 1rem; margin-bottom: 2rem; display: none;">
                <div class="info-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 id="selectedAreaName" style="color: white; margin: 0; font-size: 2rem;"></h3>
                    <div id="riskLevel" style="padding: 0.5rem 1.5rem; border-radius: 2rem; font-weight: bold;"></div>
                </div>
                
                <!-- Active Alerts -->
                <div class="alerts-section" style="margin-bottom: 2rem;">
                    <h4 style="color: white; margin-bottom: 1rem;">Active Alerts</h4>
                    <div id="alertsList" style="display: flex; flex-direction: column; gap: 1rem;"></div>
        </div>

                <!-- Quick Info Tabs -->
                <div class="info-tabs" style="margin-bottom: 2rem;">
                    <div class="tab-buttons" style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                        <button class="tab-btn active" data-tab="emergency" style="background: #006400; color: white; border: none; padding: 1rem 2rem; border-radius: 0.5rem; cursor: pointer;">Emergency Contacts</button>
                        <button class="tab-btn" data-tab="shelters" style="background: #333; color: white; border: none; padding: 1rem 2rem; border-radius: 0.5rem; cursor: pointer;">Nearby Shelters</button>
                        <button class="tab-btn" data-tab="risks" style="background: #333; color: white; border: none; padding: 1rem 2rem; border-radius: 0.5rem; cursor: pointer;">Risk Information</button>
                    </div>
                    
                    <div class="tab-content">
                        <div id="emergency-content" class="tab-pane active"></div>
                        <div id="shelters-content" class="tab-pane" style="display: none;"></div>
                        <div id="risks-content" class="tab-pane" style="display: none;"></div>
                    </div>
                </div>
            </div>


            <!-- Map Controls -->
            <div class="map-controls" style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem;">
                <button id="riskZonesBtn" class="map-btn active" style="background: #006400; color: white; border: none; padding: 1rem 2rem; border-radius: 0.5rem; cursor: pointer;">Risk Zones</button>
                <button id="safeZonesBtn" class="map-btn" style="background: #333; color: white; border: none; padding: 1rem 2rem; border-radius: 0.5rem; cursor: pointer;">Safe Zones</button>
                <button id="routesBtn" class="map-btn" style="background: #333; color: white; border: none; padding: 1rem 2rem; border-radius: 0.5rem; cursor: pointer;">Evacuation Routes</button>
                <button id="facilitiesBtn" class="map-btn" style="background: #333; color: white; border: none; padding: 1rem 2rem; border-radius: 0.5rem; cursor: pointer;">Facilities</button>
            </div>

            <!-- Map Container -->
            <div id="map" style="height: 50rem; border-radius: 1rem; margin-bottom: 2rem;"></div>
        </div>
        
        <script>
            // Modify the form button click handler
            document.querySelector('.btn-gradient-primary').addEventListener('click', function(e) {
                e.preventDefault(); // Prevent form submission
                const selectedArea = document.getElementById('inputState').value;
                
                // Scroll to map section
                document.getElementById('c_finance').scrollIntoView({ behavior: 'smooth' });
                
                // Update the area selector in the map section
                document.getElementById('areaSelector').value = selectedArea;
                
                // Trigger the area update
                updateSelectedArea(selectedArea);
                
                // Update weather service location
                weatherService.setLocation(selectedArea);
                weatherService.fetchWeatherData();
            });

            // Initialize map and layers when the document is ready
            document.addEventListener('DOMContentLoaded', function() {
                // Create the map instance
                window.mapInstance = L.map('map').setView([3.0333, 101.4444], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: ' OpenStreetMap'
                }).addTo(window.mapInstance);

                // Layer groups
                const riskZonesLayer = L.layerGroup().addTo(window.mapInstance);
                const safeZonesLayer = L.layerGroup();
                const routesLayer = L.layerGroup();
                window.facilitiesLayer = L.layerGroup();


// Add legend control with fixed positioning
const legend = L.control({position: 'bottomright'});
legend.onAdd = function(map) {
    // Create main legend container
    const div = L.DomUtil.create('div', 'info legend');
    
    // Create legend style
    const style = document.createElement('style');
    style.textContent = `
        .info.legend {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
            font-family: 'Arial', sans-serif;
            max-width: 250px;
            border-left: 4px solid #008000;
            color: #333;
            transition: all 0.3s ease;
            opacity: 0.95;
            transform: translateY(0);
            margin-bottom: 30px;
        }
        
        .info.legend:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            opacity: 1;
            transform: translateY(-2px);
        }
        
        .legend-title {
            margin: 0 0 15px 0;
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            padding-bottom: 8px;
            border-bottom: 1px solid #eaeaea;
            text-align: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 3px 0;
            transition: background-color 0.2s ease;
        }
        
        .legend-item:hover {
            background-color: rgba(240, 240, 240, 0.8);
            border-radius: 4px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            margin-right: 8px;
            display: inline-block;
            border: 1px solid rgba(0, 0, 0, 0.2);
        }
        
        .legend-text {
            font-size: 13px;
            flex-grow: 1;
        }
        
        .high-risk { background-color: #ff0000; }
        .medium-risk { background-color: #ffa500; }
        .low-risk { background-color: #ffff00; }
        .safe { background-color: #00ff00; }
        .evac-route { background-color: #0000ff; }
        .emergency { background-color: #800080; }
        
        @media (max-width: 768px) {
            .info.legend {
                max-width: 200px;
                padding: 10px;
                margin-bottom: 20px;
            }
            
            .legend-title {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .legend-item {
                margin-bottom: 6px;
            }
        }
    `;
    
    // Append style to legend
    div.appendChild(style);
    
    // Define categories with class names
    const categories = [
        { name: 'High Risk Zone', class: 'high-risk' },
        { name: 'Medium Risk Zone', class: 'medium-risk' },
        { name: 'Low Risk Zone', class: 'low-risk' },
        { name: 'Safe Zone', class: 'safe' },
        { name: 'Evacuation Route', class: 'evac-route' },
        { name: 'Emergency Facility', class: 'emergency' }
    ];
    
    // Create title
    const titleDiv = document.createElement('div');
    titleDiv.className = 'legend-title';
    titleDiv.textContent = 'Map Legend';
    div.appendChild(titleDiv);
    
    // Create legend content container
    const contentDiv = document.createElement('div');
    contentDiv.className = 'legend-content';
    
    // Add each category
    categories.forEach(category => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'legend-item';
        
        const colorSpan = document.createElement('span');
        colorSpan.className = `legend-color ${category.class}`;
        
        const textSpan = document.createElement('span');
        textSpan.className = 'legend-text';
        textSpan.textContent = category.name;
        
        itemDiv.appendChild(colorSpan);
        itemDiv.appendChild(textSpan);
        contentDiv.appendChild(itemDiv);
    });
    
    div.appendChild(contentDiv);
    
    // Add collapsible functionality
    titleDiv.style.cursor = 'pointer';
    titleDiv.addEventListener('click', function() {
        if (contentDiv.style.display === 'none') {
            contentDiv.style.display = 'block';
            titleDiv.textContent = 'Map Legend';
        } else {
            contentDiv.style.display = 'none';
            titleDiv.textContent = 'Map Legend ';
        }
    });
    
    // Make the legend draggable
    div.addEventListener('mousedown', function(e) {
        if (e.target === titleDiv) {
            let isDragging = true;
            const startX = e.clientX;
            const startY = e.clientY;
            const startLeft = parseInt(window.getComputedStyle(div).left);
            const startTop = parseInt(window.getComputedStyle(div).top);
            
            function onMouseMove(e) {
                if (!isDragging) return;
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                div.style.left = (startLeft + dx) + 'px';
                div.style.top = (startTop + dy) + 'px';
            }
            
            function onMouseUp() {
                isDragging = false;
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            }
            
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        }
    });
    
    return div;
};

// Add the legend to the map
legend.addTo(window.mapInstance);

// Optional: Add a button to toggle legend visibility
const toggleButton = L.control({position: 'bottomright'});
toggleButton.onAdd = function(map) {
    const btn = L.DomUtil.create('button', 'toggle-legend-btn');
    btn.innerHTML = 'Toggle Legend';
    btn.style.cssText = `
        background-color: #3388ff;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        margin-bottom: 10px;
        font-size: 12px;
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        transition: all 0.2s ease;
    `;
    
    btn.addEventListener('mouseenter', function() {
        this.style.backgroundColor = '#1e6ec7';
    });
    
    btn.addEventListener('mouseleave', function() {
        this.style.backgroundColor = '#3388ff';
    });
    
    btn.addEventListener('click', function() {
        const legendEl = document.querySelector('.info.legend');
        if (legendEl.style.display === 'none') {
            legendEl.style.display = 'block';
            btn.innerHTML = 'Hide Legend';
        } else {
            legendEl.style.display = 'none';
            btn.innerHTML = 'Show Legend';
        }
    });
    
    return btn;
};

// Uncomment the line below if you want to add the toggle button
toggleButton.addTo(window.mapInstance);
                

// Function to create detailed popup content that works with your existing data structure
function createPopupContent(type, data) {
    // Helper function to display data with fallback
    const displayValue = (value) => {
        if (value === undefined || value === null || value === '') {
            return 'N/A';
        }
        return value;
    };
    
    // Find facility details by coordinates if available
    const findFacilityDetails = (data) => {
        if (data.facilities && Array.isArray(data.facilities)) {
            // Return the first facility's details if available
            return data.facilities[0] || {};
        }
        return {};
    };
    
    // Get facility details
    const facilityDetails = findFacilityDetails(data);
    
    // Check if dark mode is enabled
    const isDarkMode = document.body.classList.contains('dark-theme');
    
    // Define type-specific colors and icons
    const typeConfig = {
        'risk': {
            bgColor: isDarkMode ? '#2b2b2b' : '#f8f9fa',
            headerBg: '#dc3545',
            headerColor: 'white',
            textColor: isDarkMode ? '#e1e1e1' : '#333',
            icon: '',
            borderColor: '#dc3545'
        },
        'safe': {
            bgColor: isDarkMode ? '#2b2b2b' : '#f8f9fa',
            headerBg: '#28a745',
            headerColor: 'white',
            textColor: isDarkMode ? '#e1e1e1' : '#333',
            icon: '',
            borderColor: '#28a745'
        },
        'facility': {
            bgColor: isDarkMode ? '#2b2b2b' : '#f8f9fa',
            headerBg: '#0066cc',
            headerColor: 'white',
            textColor: isDarkMode ? '#e1e1e1' : '#333',
            icon: '',
            borderColor: '#0066cc'
        },
        'route': {
            bgColor: isDarkMode ? '#2b2b2b' : '#f8f9fa',
            headerBg: '#6f42c1',
            headerColor: 'white',
            textColor: isDarkMode ? '#e1e1e1' : '#333',
            icon: '',
            borderColor: '#6f42c1'
        }
    };
    
    // Apply config based on type
    const config = typeConfig[type] || typeConfig['risk'];
    
    // Create common popup header
    let popupHeader = `
        <div style="background-color: ${config.headerBg}; color: ${config.headerColor}; padding: 12px; border-radius: 8px 8px 0 0; display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 18px;">${config.icon}</span>
            <h4 style="margin: 0; font-size: 16px; font-weight: bold;">${displayValue(data.name)}</h4>
        </div>
    `;
    
    // Common popup container start
    let popupContainer = `
        <div class="popup-content" style="max-width: 300px; font-family: Arial, sans-serif; background-color: ${config.bgColor}; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); overflow: hidden; border: 1px solid ${config.borderColor};">
            ${popupHeader}
            <div style="padding: 15px; color: ${config.textColor}; font-size: 14px;">
    `;
    
    // Create content specific to type
    let contentItems = '';
    
    switch(type) {
        case 'risk':
            contentItems = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; background-color: #f8d7da; padding: 8px; border-radius: 4px;">
                    <strong>Risk Level:</strong>
                    <span style="font-weight: bold; color: ${displayValue(data.riskColor) || '#dc3545'};">${displayValue(data.riskLevel)}</span>
            </div>
            <p style="margin: 8px 0;"><strong>Last Updated:</strong> ${new Date().toLocaleString()}</p>
            <p style="margin: 8px 0;"><strong>Hazard Type:</strong> ${data.hazardType ? displayValue(data.hazardType) : "Flood"}</p>
            <p style="margin: 8px 0;"><strong>Current Status:</strong> ${data.currentStatus ? displayValue(data.currentStatus) : "Active"}</p>
            <p style="margin: 8px 0;"><strong>Expected Duration:</strong> ${data.expectedDuration ? displayValue(data.expectedDuration) : "12-24 hours"}</p>
            <p style="margin: 8px 0;"><strong>Water Level:</strong> ${data.waterLevel ? displayValue(data.waterLevel) : "Rising"}</p>
            <p style="margin: 8px 0;"><strong>Precautions:</strong> ${data.precautions ? displayValue(data.precautions) : "Move to higher ground, avoid floodwaters"}</p>
            <p style="margin: 8px 0;"><strong>Affected Population:</strong> ${data.population ? displayValue(data.population) : "Approx. 5,000"}</p>
            <p style="margin: 8px 0;"><strong>Emergency Contact:</strong> ${data.emergencyContact ? displayValue(data.emergencyContact) : "999 or 03-3341 5555"}</p>
                <p style="margin: 8px 0;"><strong>Warning Level:</strong> ${data.warningLevel ? displayValue(data.warningLevel) : displayValue(data.riskLevel)}</p>
            <p style="margin: 8px 0;"><strong>Nearest Safe Zone:</strong> ${data.nearestSafeZone ? displayValue(data.nearestSafeZone) : "Klang Central Evacuation Center (1.2 km)"}</p>
            <p style="margin: 8px 0;"><strong>Evacuation Status:</strong> ${data.evacuationStatus ? displayValue(data.evacuationStatus) : "Mandatory"}</p>
            <p style="margin: 8px 0;"><strong>Last Incident:</strong> ${data.lastIncident ? displayValue(data.lastIncident) : "November 2023"}</p>
            `;
            break;
        
        case 'safe':
            contentItems = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; background-color: #d4edda; padding: 8px; border-radius: 4px;">
                    <strong>Status:</strong>
                    <span style="font-weight: bold; color: #28a745;">${data.status ? displayValue(data.status) : "Available"}</span>
            </div>
            <p style="margin: 8px 0;"><strong>Safe Zone Type:</strong> ${data.zoneType ? displayValue(data.zoneType) : "Emergency Shelter"}</p>
            <p style="margin: 8px 0;"><strong>Current Occupancy:</strong> ${data.currentOccupancy ? displayValue(data.currentOccupancy) : "132/200"}</p>
            <p style="margin: 8px 0;"><strong>Maximum Capacity:</strong> ${data.capacity ? displayValue(data.capacity) : "200 persons"}</p>
            <p style="margin: 8px 0;"><strong>Available Resources:</strong> ${data.resources ? displayValue(data.resources) : "Food, Water, Medical, Blankets"}</p>
            <p style="margin: 8px 0;"><strong>Facilities:</strong> ${facilityDetails.name ? displayValue(facilityDetails.name) : "Toilets, Showers, Kitchen, Medical Station"}</p>
            <p style="margin: 8px 0;"><strong>Emergency Contact:</strong> ${data.contact ? displayValue(data.contact) : "03-3342 8899"}</p>
            <p style="margin: 8px 0;"><strong>Medical Staff:</strong> ${data.medicalStaff ? displayValue(data.medicalStaff) : "Available (2 doctors, 5 nurses)"}</p>
            <p style="margin: 8px 0;"><strong>Security:</strong> ${data.security ? displayValue(data.security) : "24/7 (Police and Volunteers)"}</p>
            <p style="margin: 8px 0;"><strong>Accessibility:</strong> ${data.accessibility ? displayValue(data.accessibility) : "Wheelchair accessible"}</p>
                <p style="margin: 8px 0;"><strong>Open Hours:</strong> ${data.openingHours ? displayValue(data.openingHours) : "24/7 during emergencies"}</p>
            <p style="margin: 8px 0;"><strong>Registration Required:</strong> ${data.registrationRequired ? displayValue(data.registrationRequired) : "Yes (Upon arrival)"}</p>
            <p style="margin: 8px 0;"><strong>Notes:</strong> ${data.notes ? displayValue(data.notes) : "Bring ID documents if possible"}</p>
            `;
            break;
            
        case 'facility':
            contentItems = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; background-color: #cce5ff; padding: 8px; border-radius: 4px;">
                    <strong>Type:</strong>
                    <span style="font-weight: bold; color: #0066cc;">${facilityDetails.type ? displayValue(facilityDetails.type) : displayValue(data.type)}</span>
            </div>
            <p style="margin: 8px 0;"><strong>Name:</strong> ${facilityDetails.name ? displayValue(facilityDetails.name) : displayValue(data.name)}</p>
            <p style="margin: 8px 0;"><strong>Status:</strong> ${data.status ? displayValue(data.status) : "Operational"}</p>
            <p style="margin: 8px 0;"><strong>Address:</strong> ${data.address ? displayValue(data.address) : "Jalan Merdeka, Kawasan 1, 41000 Klang"}</p>
            <p style="margin: 8px 0;"><strong>Contact:</strong> ${data.contact ? displayValue(data.contact) : "03-3341 7722"}</p>
            <p style="margin: 8px 0;"><strong>Emergency Contact:</strong> ${data.emergencyContact ? displayValue(data.emergencyContact) : "999 or 994"}</p>
            <p style="margin: 8px 0;"><strong>Operating Hours:</strong> ${data.operatingHours ? displayValue(data.operatingHours) : "24/7"}</p>
            <p style="margin: 8px 0;"><strong>Current Capacity:</strong> ${data.currentCapacity ? displayValue(data.currentCapacity) : "65%"}</p>
            <p style="margin: 8px 0;"><strong>Services:</strong> ${data.services ? displayValue(data.services) : "Emergency Response, Search and Rescue, Medical Aid"}</p>
            <p style="margin: 8px 0;"><strong>Staff Count:</strong> ${data.staffCount ? displayValue(data.staffCount) : "32 personnel"}</p>
            <p style="margin: 8px 0;"><strong>Available Equipment:</strong> ${data.equipment ? displayValue(data.equipment) : "Rescue Boats, Trucks, Medical Supplies"}</p>
            <p style="margin: 8px 0;"><strong>Emergency Protocol:</strong> ${data.emergencyProtocol ? displayValue(data.emergencyProtocol) : "Level 2 - Enhanced Readiness"}</p>
            <p style="margin: 8px 0;"><strong>Last Inspection:</strong> ${data.lastInspection ? displayValue(data.lastInspection) : "January 15, 2024"}</p>
            `;
            break;
            
        case 'route':
            contentItems = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; background-color: #e2d9f3; padding: 8px; border-radius: 4px;">
                    <strong>Route Type:</strong>
                    <span style="font-weight: bold; color: #6f42c1;">${data.routeType ? displayValue(data.routeType) : "Evacuation"}</span>
            </div>
            <p style="margin: 8px 0;"><strong>Route Name:</strong> ${data.routeName ? displayValue(data.routeName) : "Route E-1"}</p>
            <p style="margin: 8px 0;"><strong>Status:</strong> ${data.status ? displayValue(data.status) : "Open"}</p>
            <p style="margin: 8px 0;"><strong>From:</strong> ${data.from ? displayValue(data.from) : "Klang Central (Affected Area)"}</p>
            <p style="margin: 8px 0;"><strong>To:</strong> ${data.to ? displayValue(data.to) : "Klang Central Evacuation Center"}</p>
            <p style="margin: 8px 0;"><strong>Distance:</strong> ${data.distance ? displayValue(data.distance) : "1.2 kilometers"}</p>
            <p style="margin: 8px 0;"><strong>Estimated Time:</strong> ${data.estimatedTime ? displayValue(data.estimatedTime) : "15-20 minutes (walking)"}</p>
            <p style="margin: 8px 0;"><strong>Traffic Condition:</strong> ${data.trafficCondition ? displayValue(data.trafficCondition) : "Light"}</p>
            <p style="margin: 8px 0;"><strong>Road Condition:</strong> ${data.roadCondition ? displayValue(data.roadCondition) : "Partially flooded (20cm)"}</p>
            <p style="margin: 8px 0;"><strong>Transportation Available:</strong> ${data.transportationAvailable ? displayValue(data.transportationAvailable) : "Emergency Vehicles, Boats"}</p>
            <p style="margin: 8px 0;"><strong>Checkpoints:</strong> ${data.checkpoints ? displayValue(data.checkpoints) : "2 (Police, Rescue)"}</p>
            <p style="margin: 8px 0;"><strong>Accessibility:</strong> ${data.accessibility ? displayValue(data.accessibility) : "Limited for vehicles, accessible on foot"}</p>
            <p style="margin: 8px 0;"><strong>Notes:</strong> ${data.notes ? displayValue(data.notes) : "Follow emergency personnel directions, bring minimal belongings"}</p>
            `;
            break;
    }
    
    // Close popup container
    const popupFooter = `
            </div>
            <div style="background-color: ${config.headerBg}; opacity: 0.8; color: white; font-size: 12px; text-align: center; padding: 6px;">
                Click the map to close
            </div>
        </div>
    `;
    
    // Combine all parts
    content = popupContainer + contentItems + popupFooter;
    
    return content;
}

// Area data for all regions with expanded details
const areaData = {
  "Klang Central": {
    center: [3.0441, 101.4448],
    zoom: 15,
    riskLevel: "Very High",
    riskColor: "#FF0000",
    riskZones: [
      { coords: [[3.0420, 101.4425], [3.0455, 101.4460], [3.0410, 101.4445]], color: "#FF0000" },
      { coords: [[3.0475, 101.4470], [3.0490, 101.4485], [3.0470, 101.4465]], color: "#FF3300" }
    ],
    safeZones: [
      { coords: [[3.0510, 101.4495], [3.0525, 101.4510], [3.0500, 101.4505]], color: "#00FF00" },
      { coords: [[3.0385, 101.4410], [3.0395, 101.4420], [3.0380, 101.4415]], color: "#00FF00" }
    ],
    routes: [
      { coords: [[3.0441, 101.4448], [3.0510, 101.4495]], color: "#0000FF" },
      { coords: [[3.0441, 101.4448], [3.0385, 101.4410]], color: "#0000FF" }
    ],
    facilities: [
      { lat: 3.0450, lng: 101.4455, name: "Klang Central Evacuation Center", type: "Shelter" },
      { lat: 3.0435, lng: 101.4440, name: "Klang Central Flood Monitoring Point", type: "Observation Point" }
    ],
    policeStations: [
      { 
        lat: 3.0480, 
        lng: 101.4475, 
        name: "Klang Central Police Station", 
        address: "Jalan Merdeka, Kawasan 1, 41000 Klang", 
        phone: "03-3341 5555", 
        emergencyPhone: "999", 
        status: "Operational",
        type: "District Headquarters",
        services: "Emergency Response, Crime Investigation, Public Safety, Search and Rescue"
      }
    ],
    fireStations: [
      { 
        lat: 3.0390, 
        lng: 101.4415, 
        name: "Klang Central Fire and Rescue Station", 
        address: "Jalan Tengku Kelana, 41000 Klang", 
        phone: "03-3342 7722", 
        emergencyPhone: "994", 
        status: "Operational",
        type: "Main Station",
        services: "Fire Fighting, Hazardous Materials Response, Emergency Medical Services, Search and Rescue"
      }
    ],
    medicalFacilities: [
      { 
        lat: 3.0505, 
        lng: 101.4490, 
        name: "Hospital Tengku Ampuan Rahimah", 
        address: "Jalan Langat, 41200 Klang", 
        phone: "03-3372 3333", 
        emergencyPhone: "03-3372 3333", 
        status: "Operational",
        type: "General Hospital",
        services: "Full Emergency Department, Trauma Center, General Medicine, Surgery, Pediatrics"
      },
      { 
        lat: 3.0420, 
        lng: 101.4430, 
        name: "Klinik Kesihatan Klang", 
        address: "Jalan Dato Hamid, 41000 Klang", 
        phone: "03-3375 6333", 
        emergencyPhone: "03-3375 6334", 
        status: "Operational",
        type: "Public Health Clinic",
        services: "Primary Care, Maternal Health, Child Health, Emergency First Aid"
      }
    ]
  },
  
  "Pelabuhan Klang": {
    center: [3.0010, 101.3990],
    zoom: 15,
    riskLevel: "Very High",
    riskColor: "#FF0000",
    riskZones: [
      { coords: [[3.0015, 101.4005], [3.0030, 101.4020], [3.0002, 101.4010]], color: "#FF0000" },
      { coords: [[2.9980, 101.3965], [2.9995, 101.3960], [2.9975, 101.3950]], color: "#FF3333" }
    ],
    safeZones: [
      { coords: [[3.0055, 101.4035], [3.0065, 101.4045], [3.0045, 101.4040]], color: "#00FF00" },
      { coords: [[3.0075, 101.4050], [3.0082, 101.4055], [3.0070, 101.4045]], color: "#00FF00" }
    ],
    routes: [
      { coords: [[3.0010, 101.3990], [3.0055, 101.4035]], color: "#0000FF" },
      { coords: [[2.9980, 101.3965], [3.0010, 101.3990]], color: "#0000FF" }
    ],
    facilities: [
      { lat: 3.0012, lng: 101.3995, name: "Bandar Puteri Flood Relief Center", type: "Emergency Services" },
      { lat: 3.0040, lng: 101.4028, name: "Port Authority Monitoring Station", type: "Observation Point" }
    ],
    policeStations: [
      { 
        lat: 3.0025, 
        lng: 101.4008, 
        name: "Bandar Puteri Police Station", 
        address: "Jalan Bandar Puteri, 42000 Bandar Puteri", 
        phone: "03-3167 7222", 
        emergencyPhone: "999", 
        status: "Operational",
        type: "Station",
        services: "Maritime Security, Harbor Patrol, Emergency Response"
      }
    ],
    fireStations: [
      { 
        lat: 2.9985, 
        lng: 101.3972, 
        name: "Bandar Puteri Fire & Rescue Station", 
        address: "Jalan Bandar Puteri Selatan, 42000 Bandar Puteri", 
        phone: "03-3168 4333", 
        emergencyPhone: "994", 
        status: "Operational",
        type: "Main Station",
        services: "Fire Fighting, Maritime Rescue, Hazardous Materials Response"
      }
    ],
    medicalFacilities: [
      { 
        lat: 3.0058, 
        lng: 101.4038, 
        name: "Bandar Puteri Maritime Medical Center", 
        address: "Jalan Bandar Puteri Utara, 42000 Bandar Puteri", 
        phone: "03-3169 5333", 
        emergencyPhone: "03-3169 5999", 
        status: "Operational",
        type: "Medical Center",
        services: "Emergency Care, Maritime Injuries Treatment, First Aid"
      }
    ]
  },
  
  "Kapar": {
    center: [3.1199, 101.3685],
    zoom: 15,
    riskLevel: "Medium",
    riskColor: "#FFAA00",
    riskZones: [
      { coords: [[3.1205, 101.3690], [3.1230, 101.3710], [3.1190, 101.3705]], color: "#FFAA00" },
      { coords: [[3.1165, 101.3650], [3.1190, 101.3675], [3.1150, 101.3665]], color: "#FFCC00" }
    ],
    safeZones: [
      { coords: [[3.1260, 101.3730], [3.1285, 101.3745], [3.1245, 101.3755]], color: "#00FF00" },
      { coords: [[3.1135, 101.3625], [3.1160, 101.3640], [3.1130, 101.3620]], color: "#00FF00" }
    ],
    routes: [
      { coords: [[3.1199, 101.3685], [3.1260, 101.3730]], color: "#0000FF" },
      { coords: [[3.1165, 101.3650], [3.1199, 101.3685]], color: "#0000FF" }
    ],
    facilities: [
      { lat: 3.1220, lng: 101.3710, name: "Kapar Community Center", type: "Relief Center" },
      { lat: 3.1175, lng: 101.3660, name: "Kapar Weather Station", type: "Observation Point" }
    ],
    policeStations: [
      { 
        lat: 3.1202, 
        lng: 101.3695, 
        name: "Kapar Police Station", 
        address: "Jalan Kapar Besar, 42200 Kapar", 
        phone: "03-3250 3222", 
        emergencyPhone: "999", 
        status: "Operational",
        type: "Station",
        services: "Patrol, Community Policing, Emergency Response"
      }
    ],
    fireStations: [
      { 
        lat: 3.1255, 
        lng: 101.3728, 
        name: "Kapar Fire & Rescue Station", 
        address: "Jalan Kapar Utama, 42200 Kapar", 
        phone: "03-3250 4333", 
        emergencyPhone: "994", 
        status: "Operational",
        type: "Sub-Station",
        services: "Fire Fighting, Basic Rescue Operations"
      }
    ],
    medicalFacilities: [
      { 
        lat: 3.1180, 
        lng: 101.3670, 
        name: "Kapar Health Clinic", 
        address: "Jalan Kapar Baru, 42200 Kapar", 
        phone: "03-3250 5333", 
        emergencyPhone: "03-3250 5999", 
        status: "Operational",
        type: "Government Clinic",
        services: "Primary Care, Basic Emergency Services"
      }
    ]
  },
  
  "Taman Berkeley": {
    center: [3.0620, 101.4720],
    zoom: 15,
    riskLevel: "Low",
    riskColor: "#FFFF00",
    riskZones: [
      { coords: [[3.0625, 101.4725], [3.0650, 101.4760], [3.0600, 101.4745]], color: "#FFFF00" },
      { coords: [[3.0595, 101.4695], [3.0610, 101.4710], [3.0585, 101.4705]], color: "#FFFF99" }
    ],
    safeZones: [
      { coords: [[3.0675, 101.4780], [3.0700, 101.4795], [3.0660, 101.4790]], color: "#00FF00" },
      { coords: [[3.0565, 101.4680], [3.0580, 101.4695], [3.0550, 101.4690]], color: "#00FF00" }
    ],
    routes: [
      { coords: [[3.0620, 101.4720], [3.0675, 101.4780]], color: "#0000FF" },
      { coords: [[3.0595, 101.4695], [3.0620, 101.4720]], color: "#0000FF" }
    ],
    facilities: [
      { lat: 3.0625, lng: 101.4725, name: "Berkeley Community Hall", type: "Relief Center" }
    ],
    policeStations: [
      { 
        lat: 3.0585, 
        lng: 101.4698, 
        name: "Taman Berkeley Police Station", 
        address: "Jalan Anggerik, Taman Berkeley, 41150 Klang", 
        phone: "03-3323 5222", 
        emergencyPhone: "999", 
        status: "Operational",
        type: "Station",
        services: "Patrol, Community Policing, Crime Prevention"
      }
    ],
    fireStations: [],
    medicalFacilities: [
      { 
        lat: 3.0665, 
        lng: 101.4775, 
        name: "Berkeley Medical Center", 
        address: "Jalan Anggerik 1, Taman Berkeley, 41150 Klang", 
        phone: "03-3323 7333", 
        emergencyPhone: "03-3323 7999", 
        status: "Operational",
        type: "Private Medical Center",
        services: "General Practice, Basic Emergency Services"
      }
    ]
  },
  
  "Bukit Raja": {
    center: [3.0798, 101.4468],
    zoom: 15,
    riskLevel: "Low",
    riskColor: "#FFFF00",
    riskZones: [
      { coords: [[3.0803, 101.4473], [3.0848, 101.4498], [3.0778, 101.4503]], color: "#FFFF00" },
      { coords: [[3.0763, 101.4433], [3.0788, 101.4458], [3.0753, 101.4453]], color: "#FFFF99" }
    ],
    safeZones: [
      { coords: [[3.0863, 101.4518], [3.0888, 101.4533], [3.0838, 101.4538]], color: "#00FF00" },
      { coords: [[3.0733, 101.4413], [3.0758, 101.4428], [3.0708, 101.4423]], color: "#00FF00" }
    ],
    routes: [
      { coords: [[3.0798, 101.4468], [3.0863, 101.4518]], color: "#0000FF" },
      { coords: [[3.0763, 101.4433], [3.0798, 101.4468]], color: "#0000FF" }
    ],
    facilities: [
      { lat: 3.0800, lng: 101.4470, name: "Bukit Raja Shopping Mall (Emergency Point)", type: "Relief Center" },
      { lat: 3.0845, lng: 101.4495, name: "Bukit Raja Observation Tower", type: "Observation Point" }
    ],
    policeStations: [
      { 
        lat: 3.0765, 
        lng: 101.4435, 
        name: "Bukit Raja Police Station", 
        address: "Persiaran Bukit Raja 1, 41050 Klang", 
        phone: "03-3341 2222", 
        emergencyPhone: "999", 
        status: "Operational",
        type: "Station",
        services: "Patrol, Community Policing, Crime Prevention"
      }
    ],
    fireStations: [],
    medicalFacilities: [
      { 
        lat: 3.0850, 
        lng: 101.4510, 
        name: "Bukit Raja Medical Complex", 
        address: "Persiaran Bukit Raja 1, 41050 Klang", 
        phone: "03-3341 4444", 
        emergencyPhone: "03-3341 4999", 
        status: "Operational",
        type: "Private Medical Complex",
        services: "Emergency Care, General Practice, Specialist Consultations"
      }
    ]
  },
  
  "Telok Gadong": {
    center: [3.0111, 101.4289],
    zoom: 15,
    riskLevel: "High",
    riskColor: "#FF3333",
    riskZones: [
      { coords: [[3.0116, 101.4294], [3.0141, 101.4329], [3.0091, 101.4314]], color: "#FF3333" },
      { coords: [[3.0076, 101.4254], [3.0101, 101.4279], [3.0056, 101.4274]], color: "#FF5555" }
    ],
    safeZones: [
      { coords: [[3.0156, 101.4349], [3.0171, 101.4364], [3.0121, 101.4359]], color: "#00FF00" },
      { coords: [[3.0036, 101.4234], [3.0051, 101.4249], [3.0001, 101.4244]], color: "#00FF00" }
    ],
    routes: [
      { coords: [[3.0111, 101.4289], [3.0156, 101.4349]], color: "#0000FF" },
      { coords: [[3.0076, 101.4254], [3.0111, 101.4289]], color: "#0000FF" }
    ],
    facilities: [
      { lat: 3.0115, lng: 101.4295, name: "Telok Gadong Emergency Center", type: "Emergency Services" },
      { lat: 3.0080, lng: 101.4260, name: "Coastal Monitoring Station", type: "Observation Point" }
    ],
    policeStations: [
      { 
        lat: 3.0155, 
        lng: 101.4348, 
        name: "Telok Gadong Police Station", 
        address: "Jalan Telok Gadong, 41100 Klang", 
        phone: "03-3167 2222", 
        emergencyPhone: "999", 
        status: "Operational",
        type: "Station",
        services: "Patrol, Coastal Security, Community Policing"
      }
    ],
    fireStations: [
      { 
        lat: 3.0073, 
        lng: 101.4251, 
        name: "Telok Gadong Fire Post", 
        address: "Jalan Telok Gadong Utama, 41100 Klang", 
        phone: "03-3167 3333", 
        emergencyPhone: "994", 
        status: "Limited Service",
        type: "Fire Post",
        services: "Basic Fire Fighting, First Response"
      }
    ],
    medicalFacilities: [
      { 
        lat: 3.0115, 
        lng: 101.4295, 
        name: "Telok Gadong Health Clinic", 
        address: "Jalan Telok Gadong 1, 41100 Klang", 
        phone: "03-3167 4444", 
        emergencyPhone: "03-3167 4999", 
        status: "Operational",
        type: "Government Clinic",
        services: "Primary Care, Basic Emergency Services"
      }
    ]
  },
  
  "Bandar Klang": {
    center: [3.0446, 101.4477],
    zoom: 15,
    riskLevel: "Medium",
    riskColor: "#FFAA00",
    riskZones: [
      { coords: [[3.0451, 101.4482], [3.0476, 101.4517], [3.0426, 101.4502]], color: "#FFAA00" },
      { coords: [[3.0411, 101.4442], [3.0436, 101.4467], [3.0401, 101.4452]], color: "#FFCC00" }
    ],
    safeZones: [
      { coords: [[3.0491, 101.4537], [3.0516, 101.4552], [3.0476, 101.4557]], color: "#00FF00" },
      { coords: [[3.0381, 101.4422], [3.0406, 101.4437], [3.0366, 101.4432]], color: "#00FF00" }
    ],
    routes: [
      { coords: [[3.0446, 101.4477], [3.0491, 101.4537]], color: "#0000FF" },
      { coords: [[3.0411, 101.4442], [3.0446, 101.4477]], color: "#0000FF" }
    ],
    facilities: [
      { lat: 3.0450, lng: 101.4485, name: "Bandar Klang Central Hall", type: "Relief Center" },
      { lat: 3.0480, lng: 101.4520, name: "City Center Monitoring Point", type: "Observation Point" }
    ],
    policeStations: [
      { 
        lat: 3.0453, 
        lng: 101.4488, 
        name: "Bandar Klang Police Station", 
        address: "Jalan Pasar, 41000 Klang", 
        phone: "03-3343 9222", 
        emergencyPhone: "999", 
        status: "Operational",
        type: "Station",
        services: "Patrol, Community Policing, Crime Prevention"
      }
    ],
    fireStations: [
      { 
        lat: 3.0408, 
        lng: 101.4439, 
        name: "Bandar Klang Fire Station", 
        address: "Jalan Dato Hamzah, 41000 Klang", 
        phone: "03-3343 8333", 
        emergencyPhone: "994", 
        status: "Operational",
        type: "Main Station",
        services: "Fire Fighting, Rescue Operations, Emergency Response"
      }
    ],
    medicalFacilities: [
      { 
        lat: 3.0495, 
        lng: 101.4540, 
        name: "Bandar Klang Medical Center", 
        address: "Jalan Nanas, 41000 Klang", 
        phone: "03-3343 7444", 
        emergencyPhone: "03-3343 7999", 
        status: "Operational",
        type: "Private Medical Center",
        services: "Emergency Care, General Practice, Specialist Consultations"
      },
      { 
        lat: 3.0385, 
        lng: 101.4425, 
        name: "City Health Clinic", 
        address: "Jalan Kota, 41000 Klang", 
        phone: "03-3343 6555", 
        emergencyPhone: "03-3343 6500", 
        status: "Operational",
        type: "Government Clinic",
        services: "Primary Care, Basic Emergency Services"
      }
    ]
  },
  
  "Taman Sri Andalas": {
    center: [3.0250, 101.4498],
    zoom: 15,
    riskLevel: "High",
    riskColor: "#FF6600",
    riskZones: [
      { coords: [[3.0230, 101.4480], [3.0260, 101.4505], [3.0210, 101.4490]], color: "#FF6600" },
      { coords: [[3.0275, 101.4520], [3.0290, 101.4535], [3.0270, 101.4515]], color: "#FF9933" }
    ],
    safeZones: [
      { coords: [[3.0310, 101.4545], [3.0325, 101.4570], [3.0300, 101.4560]], color: "#00FF00" },
      { coords: [[3.0195, 101.4460], [3.0210, 101.4470], [3.0180, 101.4465]], color: "#00FF00" }
    ],
    routes: [
      { coords: [[3.0250, 101.4498], [3.0310, 101.4545]], color: "#0000FF" },
      { coords: [[3.0250, 101.4498], [3.0195, 101.4460]], color: "#0000FF" }
    ],
    facilities: [
      { lat: 3.0265, lng: 101.4510, name: "Sri Andalas Community Center", type: "Shelter" },
      { lat: 3.0220, lng: 101.4485, name: "Taman Sri Andalas Flood Monitoring Point", type: "Observation Point" }
    ],
    policeStations: [
      { 
        lat: 3.0285, 
        lng: 101.4530, 
        name: "Sri Andalas Police Station", 
        address: "Jalan Sri Andalas 3, Taman Sri Andalas, 41200 Klang", 
        phone: "03-3371 2222", 
        emergencyPhone: "999", 
        status: "Operational",
        type: "Police Station",
        services: "Community Policing, Emergency Response, Search and Rescue"
      }
    ],
    fireStations: [
      { 
        lat: 3.0205, 
        lng: 101.4475, 
        name: "Sri Andalas Fire Station", 
        address: "Jalan Andalas Utama, Taman Sri Andalas, 41200 Klang", 
        phone: "03-3372 8454", 
        emergencyPhone: "994", 
        status: "Operational",
        type: "Main Station",
        services: "Fire Fighting, Rescue, Emergency Response"
      }
    ],
    medicalFacilities: [
      { 
        lat: 3.0315, 
        lng: 101.4550, 
        name: "Sri Andalas Medical Center", 
        address: "Jalan Sri Andalas 8, Taman Sri Andalas, 41200 Klang", 
        phone: "03-3375 7700", 
        emergencyPhone: "03-3375 7777", 
        status: "Operational",
        type: "Medical Center",
        services: "Emergency Care, General Practice, Pharmacy"
      }
    ]
  },
  
  "Pandamaran": {
    center: [3.0155, 101.4182],
    zoom: 15,
    riskLevel: "High",
    riskColor: "#FF3333",
    riskZones: [
      { coords: [[3.0160, 101.4190], [3.0195, 101.4220], [3.0135, 101.4215]], color: "#FF3333" },
      { coords: [[3.0115, 101.4145], [3.0140, 101.4170], [3.0100, 101.4165]], color: "#FF5555" }
    ],
    safeZones: [
      { coords: [[3.0210, 101.4235], [3.0235, 101.4250], [3.0185, 101.4245]], color: "#00FF00" },
      { coords: [[3.0080, 101.4125], [3.0105, 101.4140], [3.0055, 101.4135]], color: "#00FF00" }
    ],
    routes: [
      { coords: [[3.0155, 101.4182], [3.0210, 101.4235]], color: "#0000FF" },
      { coords: [[3.0115, 101.4145], [3.0155, 101.4182]], color: "#0000FF" }
    ],
    facilities: [
      { lat: 3.0158, lng: 101.4185, name: "Pandamaran Disaster Relief Center", type: "Emergency Services" },
      { lat: 3.0125, lng: 101.4155, name: "Coastal Monitoring Station", type: "Observation Point" }
    ],
    policeStations: [
      { 
        lat: 3.0090, 
        lng: 101.4135, 
        name: "Pandamaran Police Station", 
        address: "Jalan Pandamaran Jaya 1, 42000 Pandamaran, Klang", 
        phone: "03-3165 7890", 
        emergencyPhone: "999", 
        status: "Operational",
        type: "Station",
        services: "Patrol, Community Policing, Crime Prevention"
      }
    ],
    fireStations: [
      { 
        lat: 3.0200, 
        lng: 101.4225, 
        name: "Pandamaran Fire & Rescue Station", 
        address: "Jalan Pandamaran Jaya 3, 42000 Pandamaran, Klang", 
        phone: "03-3165 3456", 
        emergencyPhone: "994", 
        status: "Operational",
        type: "Main Station",
        services: "Fire Fighting, Rescue Operations, Hazardous Materials Response"
      }
    ],
    medicalFacilities: [
      { 
        lat: 3.0156, 
        lng: 101.4180, 
        name: "Pandamaran Health Clinic", 
        address: "Jalan Pandamaran Jaya 2, 42000 Pandamaran, Klang", 
        phone: "03-3165 4567", 
        emergencyPhone: "03-3165 4500", 
        status: "Operational",
        type: "Community Clinic",
        services: "Primary Care, Basic Emergency Services"
      }
    ]
  },
  
  "Klang Utara": {
    center: [3.0750, 101.4480],
    zoom: 15,
    riskLevel: "Medium",
    riskColor: "#FF9933",
    riskZones: [
      { coords: [[3.0755, 101.4485], [3.0790, 101.4520], [3.0730, 101.4515]], color: "#FF9933" },
      { coords: [[3.0715, 101.4445], [3.0740, 101.4470], [3.0700, 101.4465]], color: "#FFBB33" }
    ],
    safeZones: [
      { coords: [[3.0805, 101.4535], [3.0830, 101.4550], [3.0780, 101.4555]], color: "#00FF00" },
      { coords: [[3.0685, 101.4425], [3.0710, 101.4440], [3.0670, 101.4435]], color: "#00FF00" }
    ],
    routes: [
      { coords: [[3.0750, 101.4480], [3.0805, 101.4535]], color: "#0000FF" },
      { coords: [[3.0715, 101.4445], [3.0750, 101.4480]], color: "#0000FF" }
    ],
    facilities: [
      { lat: 3.0752, lng: 101.4483, name: "North Klang Crisis Center", type: "Emergency Services" },
      { lat: 3.0735, lng: 101.4460, name: "River Monitoring Station", type: "Observation Point" }
    ],
    policeStations: [
      { 
        lat: 3.0800, 
        lng: 101.4530, 
        name: "North Klang Police Station", 
        address: "Jalan Meru 5, Klang Utara, 41050 Klang", 
        phone: "03-3290 1234", 
        emergencyPhone: "999", 
        status: "Operational",
        type: "Station",
        services: "Patrol, Community Policing, Crime Prevention"
      }
    ],
    fireStations: [
      { 
        lat: 3.0690, 
        lng: 101.4430, 
        name: "North Klang Fire Station", 
        address: "Jalan Meru 8, Klang Utara, 41050 Klang", 
        phone: "03-3290 5678", 
        emergencyPhone: "994", 
        status: "Operational",
        type: "Main Station",
        services: "Fire Fighting, Rescue Operations, Hazardous Materials Response"
      }
    ],
    medicalFacilities: [
      { 
        lat: 3.0751, 
        lng: 101.4480, 
        name: "North Klang Medical Center", 
        address: "Jalan Meru 3, Klang Utara, 41050 Klang", 
        phone: "03-3290 8765", 
        emergencyPhone: "03-3290 8700", 
        status: "Operational",
        type: "Private Medical Center",
        services: "Emergency Care, Specialist Consultations"
      }
    ]
  },
  
  "Klang Selatan": {
    "center": [3.0350, 101.4520],
    "zoom": 15,
    "riskLevel": "Low",
    "riskColor": "#FFCC33",
    "riskZones": [
      { "coords": [[3.0365, 101.4540], [3.0370, 101.4545], [3.0360, 101.4550]], "color": "#FFCC33" },
      { "coords": [[3.0335, 101.4500], [3.0330, 101.4495], [3.0340, 101.4490]], "color": "#FFDD55" }
    ],
    "safeZones": [
      { "coords": [[3.0380, 101.4555], [3.0385, 101.4560], [3.0375, 101.4565]], "color": "#00FF00" },
      { "coords": [[3.0320, 101.4485], [3.0315, 101.4480], [3.0325, 101.4475]], "color": "#00FF00" }
    ],
    "routes": [
      { "coords": [[3.0350, 101.4520], [3.0380, 101.4555]], "color": "#0000FF" },
      { "coords": [[3.0335, 101.4500], [3.0350, 101.4520]], "color": "#0000FF" }
    ],
    "facilities": [
      { "lat": 3.0355, "lng": 101.4528, "name": "Klang Selatan Disaster Response Unit", "type": "Emergency Services" },
      { "lat": 3.0345, "lng": 101.4510, "name": "Local Flood Watch Tower", "type": "Observation Point" }
    ],
    "policeStations": [
      {
        "lat": 3.0370,
        "lng": 101.4545,
        "name": "Klang Selatan District Police",
        "address": "Jalan Tun Perak, Klang Selatan, 41000 Klang",
        "phone": "03-3371 2222",
        "emergencyPhone": "999",
        "status": "Operational",
        "type": "District Headquarters",
        "services": "General Policing, Criminal Investigation, Traffic Enforcement, Emergency Response"
      }
    ],
    "fireStations": [
      {
        "lat": 3.0330,
        "lng": 101.4490,
        "name": "Klang Selatan Fire & Rescue Station",
        "address": "Lebuhraya Shah Alam, Klang Selatan, 41000 Klang",
        "phone": "03-3371 3333",
        "emergencyPhone": "994",
        "status": "Operational",
        "type": "Main Station",
        "services": "Fire Suppression, Rescue Operations, Hazmat Response, Community Safety Programs"
      }
    ],
    "medicalFacilities": [
      {
        "lat": 3.0385,
        "lng": 101.4560,
        "name": "Hospital Tengku Ampuan Rahimah (Emergency Department)",
        "address": "Jalan Rumah Sakit, 41200 Klang",
        "phone": "03-3375 7000",
        "emergencyPhone": "999",
        "status": "Operational",
        "type": "Government Hospital",
        "services": "Comprehensive Medical Care, Specialist Services, 24/7 Emergency Care"
      }
    ]
  },

  "Pelabuhan Klang": {
    "center": [3.0024, 101.3598],
    "zoom": 15,
    "riskLevel": "Very High",
    "riskColor": "#FF0000",
    "riskZones": [
      { coords: [[3.0040, 101.3620], [3.0045, 101.3625], [3.0035, 101.3630]], color: "#FF0000" },
      { coords: [[3.0010, 101.3575], [3.0005, 101.3570], [3.0015, 101.3565]], color: "#FF5555" }
    ],
    "safeZones": [
      { coords: [[3.0070, 101.3650], [3.0075, 101.3655], [3.0065, 101.3660]], color: "#00FF00" },
      { coords: [[2.9980, 101.3530], [2.9975, 101.3525], [2.9985, 101.3520]], color: "#00FF00" }
    ],
    "routes": [
      { coords: [[3.0024, 101.3598], [3.0070, 101.3650]], color: "#0000FF" },
      { coords: [[2.9980, 101.3530], [3.0024, 101.3598]], color: "#0000FF" }
    ],
    "facilities": [
      { lat: 3.0050, lng: 101.3630, name: "Port Klang Integrated Command Center", type: "Emergency Services" },
      { lat: 2.9995, lng: 101.3550, name: "Harbor Surveillance Station", type: "Observation Point" }
    ],
    "policeStations": [
      { 
        lat: 3.0065, 
        lng: 101.3645, 
        name: "Pelabuhan Klang Central Police Station", 
        address: "Jalan Polis, Pelabuhan Klang, 42000 Klang", 
        phone: "03-3168 8888", 
        emergencyPhone: "999", 
        status: "Operational",
        type: "Headquarters",
        services: "Port Security, Customs Liaison, General Policing, Emergency Response"
      },
      {
        lat: 2.9985,
        lng: 101.3535,
        name: "Marine Police - Port Klang Jetty",
        address: "Terminal Penumpang, Pelabuhan Klang, 42000 Klang",
        phone: "03-3168 9999",
        emergencyPhone: "999",
        status: "Operational",
        type: "Marine Unit",
        services: "Coastal Patrol, Maritime Security, Search and Rescue (Sea)"
      }
    ],
    "fireStations": [
      { 
        lat: 3.0055, 
        lng: 101.3635, 
        name: "Pelabuhan Klang Fire & Rescue Main Station", 
        address: "Jalan Bomba, Pelabuhan Klang, 42000 Klang", 
        phone: "03-3168 0000", 
        emergencyPhone: "994", 
        status: "Operational",
        type: "Main Station",
        services: "Industrial Fire Fighting, Maritime Fire Response, Hazmat Control, Specialized Rescue"
      }
    ],
    "medicalFacilities": [
      { 
        lat: 3.0075, 
        lng: 101.3655, 
        name: "Klinik Kesihatan Pelabuhan Utara", 
        address: "Jalan Terminal Utara, Pelabuhan Klang, 42000 Klang", 
        phone: "03-3168 1111", 
        emergencyPhone: "03-3168 1100", 
        status: "Operational",
        type: "Government Clinic",
        services: "General Medical Care, Port Worker Health Services, Basic Emergency Treatment"
      },
      {
        lat: 2.9975,
        lng: 101.3525,
        name: "Westport Medical Emergency Response Team (WERT)",
        address: "Jalan Westport 7, Pulau Indah, 42000 Klang",
        phone: "03-3168 2222",
        emergencyPhone: "03-3168 2200",
        status: "Operational",
        type: "Industrial Emergency Service",
        services: "On-site Emergency Medical Response, First Aid, Stabilization"
      }
    ]
  },

  "Bandar Botanic": {
    "center": [2.9950, 101.4630],
    "zoom": 15,
    "riskLevel": "Low",
    "riskColor": "#FFCC33",
    "riskZones": [
      { "coords": [[2.9965, 101.4650], [2.9970, 101.4655], [2.9960, 101.4660]], "color": "#FFCC33" },
      { "coords": [[2.9935, 101.4610], [2.9930, 101.4605], [2.9940, 101.4600]], "color": "#FFDD55" }
    ],
    "safeZones": [
      { "coords": [[2.9980, 101.4665], [2.9985, 101.4670], [2.9975, 101.4675]], "color": "#00FF00" },
      { "coords": [[2.9920, 101.4595], [2.9915, 101.4590], [2.9925, 101.4585]], "color": "#00FF00" }
    ],
    "routes": [
      { "coords": [[2.9950, 101.4630], [2.9980, 101.4665]], "color": "#0000FF" },
      { "coords": [[2.9935, 101.4610], [2.9950, 101.4630]], "color": "#0000FF" }
    ],
    "facilities": [
      { "lat": 2.9955, "lng": 101.4638, "name": "Botanic Garden Community Safety Post", "type": "Emergency Services" },
      { "lat": 2.9945, "lng": 101.4620, "name": "Local Environment Monitoring Station", "type": "Observation Point" }
    ],
    "policeStations": [
      {
        "lat": 2.9970,
        "lng": 101.4655,
        "name": "Bandar Botanic Police Station",
        "address": "Jalan Anggerik 1/KS7, Bandar Botanic, 41200 Klang",
        "phone": "03-3324 5555",
        "emergencyPhone": "999",
        "status": "Operational",
        "type": "Station",
        "services": "Residential Patrol, Community Engagement, Crime Prevention Initiatives"
      }
    ],
    "fireStations": [
      {
        "lat": 2.9930,
        "lng": 101.4600,
        "name": "Bandar Botanic Fire & Rescue Sub-Station",
        "address": "Jalan Kasuarina 1, Bandar Botanic, 41200 Klang",
        "phone": "03-3324 6666",
        "emergencyPhone": "994",
        "status": "Operational",
        "type": "Sub-Station",
        "services": "Rapid Response, Basic Fire Fighting, First Aid Capabilities"
      }
    ],
    "medicalFacilities": [
      {
        "lat": 2.9985,
        "lng": 101.4670,
        "name": "Columbia Asia Hospital - Klang (Emergency Department)",
        "address": "Persiaran Astana, Bandar Botanic, 41200 Klang",
        "phone": "03-3343 9000",
        "emergencyPhone": "999",
        "status": "Operational",
        "type": "Private Hospital",
        "services": "Full-fledged Medical Services, Specialist Clinics, 24/7 Emergency Care"
      }
    ]
  },

  "Bandar Sentosa": {
    "center": [3.0283, 101.4328],
    "zoom": 15,
    "riskLevel": "Medium",
    "riskColor": "#FF9933",
    "riskZones": [
      { "coords": [[3.0298, 101.4348], [3.0303, 101.4353], [3.0293, 101.4358]], "color": "#FF9933" },
      { "coords": [[3.0268, 101.4308], [3.0263, 101.4303], [3.0273, 101.4298]], "color": "#FFBB33" }
    ],
    "safeZones": [
      { "coords": [[3.0313, 101.4363], [3.0318, 101.4368], [3.0308, 101.4373]], "color": "#00FF00" },
      { "coords": [[3.0253, 101.4288], [3.0248, 101.4283], [3.0258, 101.4278]], "color": "#00FF00" }
    ],
    "routes": [
      { "coords": [[3.0283, 101.4328], [3.0313, 101.4363]], "color": "#0000FF" },
      { "coords": [[3.0268, 101.4308], [3.0283, 101.4328]], "color": "#0000FF" }
    ],
    "facilities": [
      { "lat": 3.0288, "lng": 101.4335, "name": "Bandar Sentosa Community Safety Center", "type": "Emergency Services" },
      { "lat": 3.0278, "lng": 101.4315, "name": "Local Disaster Preparedness Office", "type": "Observation Point" }
    ],
    "policeStations": [
      {
        "lat": 3.0303,
        "lng": 101.4353,
        "name": "Bandar Sentosa Police Station",
        "address": "Jalan Langat, Bandar Sentosa, 41200 Klang",
        "phone": "03-3372 7777",
      }
    ]
  },

  "Bandar Puteri": {
    "center": [3.0325, 101.4580],
    "zoom": 15,
    "riskLevel": "High",
    "riskColor": "#FF3333",
    "riskZones": [
      { "coords": [[3.0335, 101.4595], [3.0350, 101.4605], [3.0322, 101.4615]], "color": "#FF3333" },
      { "coords": [[3.0300, 101.4565], [3.0315, 101.4560], [3.0295, 101.4550]], "color": "#FF5555" }
    ],
    "safeZones": [
      { "coords": [[3.0365, 101.4635], [3.0375, 101.4645], [3.0355, 101.4640]], "color": "#00FF00" },
      { "coords": [[3.0285, 101.4520], [3.0295, 101.4525], [3.0280, 101.4515]], "color": "#00FF00" }
    ],
    "routes": [
      { "coords": [[3.0325, 101.4580], [3.0365, 101.4635]], "color": "#0000FF" },
      { "coords": [[3.0300, 101.4565], [3.0325, 101.4580]], "color": "#0000FF" }
    ],
    "facilities": [
      { "lat": 3.0330, "lng": 101.4585, "name": "Bandar Puteri Flood Relief Center", "type": "Emergency Services" },
      { "lat": 3.0350, "lng": 101.4615, "name": "Bandar Puteri Community Monitoring Station", "type": "Observation Point" }
    ],
    "policeStations": [
      { 
        "lat": 3.0365, 
        "lng": 101.4635, 
        "name": "Bandar Puteri Police Station", 
        "address": "Jalan Puteri 1, Bandar Puteri, 42000 Klang", 
        "phone": "03-3169 7777", 
        "emergencyPhone": "999", 
        "status": "Operational",
        "type": "Station",
        "services": "Community Policing, Emergency Response, Crime Prevention"
      }
    ],
    "fireStations": [
      { 
        "lat": 3.0375, 
        "lng": 101.4645, 
        "name": "Bandar Puteri Fire & Rescue Station", 
        "address": "Jalan Puteri 2, Bandar Puteri, 42000 Klang", 
        "phone": "03-3169 8888", 
        "emergencyPhone": "994", 
        "status": "Operational",
        "type": "Sub-Station",
        "services": "Fire Fighting, Basic Rescue Operations, Community Safety Programs"
      }
    ],
    "medicalFacilities": [
      { 
        "lat": 3.0355, 
        "lng": 101.4640, 
        "name": "Bandar Puteri Medical Center", 
        "address": "Jalan Puteri 3, Bandar Puteri, 42000 Klang", 
        "phone": "03-3169 9999", 
        "emergencyPhone": "03-3169 9900", 
        "status": "Operational",
        "type": "Private Medical Center",
        "services": "Emergency Care, General Medicine, Specialist Consultations"
      }
    ]
  },

  "Bandar Bukit Tinggi": {
    "center": [3.0674, 101.4626],
    "zoom": 15,
    "riskLevel": "Low",
    "riskColor": "#FFFF00",
    "riskZones": [
      { "coords": [[3.0678, 101.4630], [3.0683, 101.4635], [3.0673, 101.4640]], "color": "#FFFF00" },
      { "coords": [[3.0648, 101.4600], [3.0643, 101.4595], [3.0653, 101.4590]], "color": "#FFFF99" }
    ],
    "safeZones": [
      { "coords": [[3.0693, 101.4645], [3.0698, 101.4650], [3.0688, 101.4655]], "color": "#00FF00" },
      { "coords": [[3.0633, 101.4585], [3.0628, 101.4580], [3.0638, 101.4575]], "color": "#00FF00" }
    ],
    "routes": [
      { "coords": [[3.0674, 101.4626], [3.0693, 101.4645]], "color": "#0000FF" },
      { "coords": [[3.0648, 101.4600], [3.0674, 101.4626]], "color": "#0000FF" }
    ],
    "facilities": [
      { "lat": 3.0678, "lng": 101.4630, "name": "Bukit Tinggi Community Safety Center", "type": "Emergency Services" },
      { "lat": 3.0648, "lng": 101.4600, "name": "Local Environment Monitoring Station", "type": "Observation Point" }
    ],
    "policeStations": [
      {
        "lat": 3.0683,
        "lng": 101.4635,
        "name": "Bandar Bukit Tinggi Police Station",
        "address": "Jalan Bukit Tinggi 1, Bandar Bukit Tinggi, 41200 Klang",
        "phone": "03-3324 7777",
        "emergencyPhone": "999",
        "status": "Operational",
        "type": "Station",
        "services": "Residential Patrol, Community Engagement, Crime Prevention"
      }
    ],
    "fireStations": [
      {
        "lat": 3.0643,
        "lng": 101.4595,
        "name": "Bandar Bukit Tinggi Fire & Rescue Sub-Station",
        "address": "Jalan Bukit Tinggi 2, Bandar Bukit Tinggi, 41200 Klang",
        "phone": "03-3324 8888",
        "emergencyPhone": "994",
        "status": "Operational",
        "type": "Sub-Station",
        "services": "Rapid Response, Basic Fire Fighting, First Aid Capabilities"
      }
    ],
    "medicalFacilities": [
      {
        "lat": 3.0698,
        "lng": 101.4650,
        "name": "Bandar Bukit Tinggi Medical Center",
        "address": "Jalan Bukit Tinggi 3, Bandar Bukit Tinggi, 41200 Klang",
        "phone": "03-3324 9999",
        "emergencyPhone": "03-3324 9900",
        "status": "Operational",
        "type": "Private Medical Center",
        "services": "Emergency Care, General Practice, Specialist Consultations"
      }
    ]
  }
};

                // Function to update map layers with enhanced popups
                function updateMapLayers(areaName) {
                    // Clear existing layers
                    riskZonesLayer.clearLayers();
                    safeZonesLayer.clearLayers();
                    routesLayer.clearLayers();
                    window.facilitiesLayer.clearLayers();

                    const area = areaData[areaName];
                    if (!area) return;

                    // Add risk zones with enhanced popups
                    if (area.riskZones) {
                        area.riskZones.forEach(zone => {
                            L.polygon(zone.coords, {
                                color: zone.color,
                                fillOpacity: 0.5
                            }).bindPopup(createPopupContent('risk', zone)).addTo(riskZonesLayer);
                        });
                    }

                    // Add safe zones with enhanced popups
                    if (area.safeZones) {
                        area.safeZones.forEach(zone => {
                            L.polygon(zone.coords, {
                                color: zone.color,
                                fillOpacity: 0.5
                            }).bindPopup(createPopupContent('safe', zone)).addTo(safeZonesLayer);
                        });
                    }

                    // Add evacuation routes with enhanced popups
                    if (area.routes) {
                        area.routes.forEach(route => {
                            L.polyline(route.coords, {
                                color: route.color,
                                weight: 3
                            }).bindPopup(createPopupContent('route', route)).addTo(routesLayer);
                        });
                    }

                    // Add facilities with enhanced popups
                    addFacilitiesToMap(area);

                    // Also update the resources panel
                    updateResourcesPanel(areaName);
                }

                // Function to add different facility types to map with custom markers
                function addFacilitiesToMap(area) {
                    // Add police stations with blue shield icon
                    if (area.policeStations) {
                        area.policeStations.forEach(station => {
                            const marker = L.marker([station.lat, station.lng], {
                                icon: L.divIcon({
                                    className: 'facility-marker police-marker',
                                    html: `<div style="background-color: #0066ff; width: 24px; height: 24px; border-radius: 50%; border: 2px solid white; display: flex; justify-content: center; align-items: center; color: white; font-weight: bold; font-size: 16px;"></div>`
                                })
                            });
                            
                            // Create enhanced popup content
                            const popupContent = createFacilityPopup(station, 'police');
                            marker.bindPopup(popupContent);
                            
                            // Store reference for highlighting
                            station.marker = marker;
                            
                            // Add event to highlight corresponding item in panel
                            marker.on('click', function() {
                                highlightFacilityInPanel('police', station.name);
                            });
                            
                            marker.addTo(window.facilitiesLayer);
                        });
                    }
                    
                    // Add fire stations with red flame icon
                    if (area.fireStations) {
                        area.fireStations.forEach(station => {
                            const marker = L.marker([station.lat, station.lng], {
                                icon: L.divIcon({
                                    className: 'facility-marker fire-marker',
                                    html: `<div style="background-color: #ff3300; width: 24px; height: 24px; border-radius: 50%; border: 2px solid white; display: flex; justify-content: center; align-items: center; color: white; font-weight: bold; font-size: 16px;"></div>`
                                })
                            });
                            
                            // Create enhanced popup content
                            const popupContent = createFacilityPopup(station, 'fire');
                            marker.bindPopup(popupContent);
                            
                            // Store reference for highlighting
                            station.marker = marker;
                            
                            // Add event to highlight corresponding item in panel
                            marker.on('click', function() {
                                highlightFacilityInPanel('fire', station.name);
                            });
                            
                            marker.addTo(window.facilitiesLayer);
                        });
                    }
                    
                    // Add medical facilities with white cross on green background
                    if (area.medicalFacilities) {
                        area.medicalFacilities.forEach(facility => {
                            const marker = L.marker([facility.lat, facility.lng], {
                                icon: L.divIcon({
                                    className: 'facility-marker medical-marker',
                                    html: `<div style="background-color: #00cc66; width: 24px; height: 24px; border-radius: 50%; border: 2px solid white; display: flex; justify-content: center; align-items: center; color: white; font-weight: bold; font-size: 16px;">+</div>`
                                })
                            });
                            
                            // Create enhanced popup content
                            const popupContent = createFacilityPopup(facility, 'medical');
                            marker.bindPopup(popupContent);
                            
                            // Store reference for highlighting
                            facility.marker = marker;
                            
                            // Add event to highlight corresponding item in panel
                            marker.on('click', function() {
                                highlightFacilityInPanel('medical', facility.name);
                            });
                            
                            marker.addTo(window.facilitiesLayer);
                        });
                    }
                    
                    // Add other facilities from the original facilities array if it exists
                    if (area.facilities) {
                        area.facilities.forEach(facility => {
                            const marker = L.marker([facility.lat, facility.lng], {
                                icon: L.divIcon({
                                    className: 'facility-marker other-marker',
                                    html: `<div style="background-color: #9900cc; width: 24px; height: 24px; border-radius: 50%; border: 2px solid white; display: flex; justify-content: center; align-items: center; color: white; font-weight: bold; font-size: 16px;"></div>`
                                })
                            });
                            
                            marker.bindPopup(createPopupContent('facility', facility));
                            marker.addTo(window.facilitiesLayer);
                        });
                    }
                }

                // Create an enhanced popup for facility markers
                function createFacilityPopup(facility, type) {
                    const status = facility.status || 'Operational';
                    const statusColor = status === 'Operational' ? '#28a745' : 
                                       status === 'Limited Service' ? '#ffc107' : 
                                       status === 'Closed' ? '#dc3545' : '#6c757d';
                    
                    // Format phone number for mobile devices
                    const phoneFormatted = facility.phone ? facility.phone.replace(/[^\d+]/g, '') : '';
                    
                    // Check if dark mode is enabled
                    const isDarkMode = document.body.classList.contains('dark-theme');
                    const bgColor = isDarkMode ? '#2b2b2b' : '#f8f9fa';
                    const textColor = isDarkMode ? '#e1e1e1' : '#333';
                    
                    // Determine icon based on facility type
                    let icon = '';
                    let headerColor = '#0066cc';
                    if (type === 'police') {
                        icon = '';
                        headerColor = '#0066ff';
                    } else if (type === 'fire') {
                        icon = '';
                        headerColor = '#dc3545';
                    } else if (type === 'hospital') {
                        icon = '';
                        headerColor = '#28a745';
                    } else if (type === 'shelter') {
                        icon = '';
                        headerColor = '#fd7e14';
                    }
                    
                    return `
                    <div class="facility-popup" style="min-width: 250px; font-family: Arial, sans-serif; background-color: ${bgColor}; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); overflow: hidden; border: 1px solid ${headerColor};">
                        <div style="background-color: ${headerColor}; color: white; padding: 12px; border-radius: 8px 8px 0 0; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 18px;">${icon}</span>
                            <h4 style="margin: 0; font-size: 16px; font-weight: bold;">${facility.name}</h4>
                        </div>
                        
                        <div style="padding: 15px; color: ${textColor}; font-size: 14px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; background-color: ${status === 'Operational' ? (isDarkMode ? '#152c19' : '#d4edda') : status === 'Limited Service' ? (isDarkMode ? '#332c0c' : '#fff3cd') : (isDarkMode ? '#2c1517' : '#f8d7da')}; padding: 8px; border-radius: 4px;">
                                <strong>Status:</strong>
                            <span style="font-weight: bold; color: ${statusColor};">${status}</span>
                        </div>
                            
                            <p style="margin: 8px 0;"><strong>Address:</strong> ${facility.address || 'Location shown on map'}</p>
                            <p style="margin: 8px 0;"><strong>Phone:</strong> ${facility.phone ? `<a href="tel:${phoneFormatted}" style="color: ${isDarkMode ? '#66b0ff' : headerColor}; text-decoration: none;">${facility.phone}</a>` : 'N/A'}</p>
                            <p style="margin: 8px 0;"><strong>Emergency:</strong> ${facility.emergencyPhone ? `<a href="tel:${facility.emergencyPhone.replace(/[^\d+]/g, '')}" style="color: ${isDarkMode ? '#ff6b6b' : '#dc3545'}; text-decoration: none; font-weight: bold;">${facility.emergencyPhone}</a>` : 'N/A'}</p>
                            ${facility.type ? `<p style="margin: 8px 0;"><strong>Type:</strong> ${facility.type}</p>` : ''}
                            ${facility.services ? `<p style="margin: 8px 0;"><strong>Services:</strong> ${facility.services}</p>` : ''}
                        </div>
                        
                        <div style="background-color: ${headerColor}; opacity: 0.8; color: white; font-size: 12px; text-align: center; padding: 6px;">
                            Click the map to close
                        </div>
                    </div>
                    `;
                }

                // Function to highlight a facility on the map when clicked in the resources panel
                window.highlightFacilityOnMap = function(lat, lng, facilityName) {
                    // Center map on the facility
                    window.mapInstance.setView([lat, lng], 17);
                    
                    // Find and open the popup for the facility
                    window.facilitiesLayer.eachLayer(function(layer) {
                        const layerLatLng = layer.getLatLng();
                        if (layerLatLng.lat === lat && layerLatLng.lng === lng) {
                            layer.openPopup();
                            
                            // Highlight the marker temporarily
                            const originalIcon = layer.getIcon();
                            const originalHtml = originalIcon.options.html;
                            
                            // Create a pulsing effect by changing the icon
                            layer.setIcon(L.divIcon({
                                className: originalIcon.options.className + ' highlight-marker',
                                html: originalHtml.replace('width: 24px; height: 24px;', 'width: 36px; height: 36px; box-shadow: 0 0 15px #ffff00, 0 0 30px #ffff00;'),
                                iconSize: [36, 36]
                            }));
                            
                            // Reset the icon after 3 seconds
                            setTimeout(function() {
                                layer.setIcon(originalIcon);
                            }, 3000);
                        }
                    });
                    
                    // Also make sure the Facilities button is active
                    window.showFacilities();
                }

                // Function to highlight a facility in the resources panel when clicked on the map
                function highlightFacilityInPanel(type, facilityName) {
                    let facilityList;
                    switch(type) {
                        case 'police':
                            facilityList = document.getElementById('policeStationsList');
                            break;
                        case 'fire':
                            facilityList = document.getElementById('fireStationsList');
                            break;
                        case 'medical':
                            facilityList = document.getElementById('medicalFacilitiesList');
                            break;
                        default:
                            return;
                    }
                    
                    // If the resources panel isn't visible, make it visible
                    document.getElementById('resourcesContent').style.display = 'block';
                    
                    // Find the facility card and highlight it
                    const cards = facilityList.querySelectorAll('.facility-card');
                    let found = false;
                    
                    cards.forEach(card => {
                        const cardTitle = card.querySelector('h4').textContent;
                        card.classList.remove('highlighted-card');
                        
                        if (cardTitle === facilityName) {
                            card.classList.add('highlighted-card');
                            // Scroll the card into view
                            card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            found = true;
                        }
                    });
                    
                    return found;
                }

                // Function to update selected area
                window.updateSelectedArea = function(areaName) {
                    if (!areaName) return;
                    
                    const area = areaData[areaName];
                    if (!area) return;

                    // Update map view
                    window.mapInstance.setView(area.center, area.zoom);
                    
                    // Update layers
                    updateMapLayers(areaName);
                    
                    // Update weather data for this area
                    if (window.weatherService) {
                        weatherService.setLocation(areaName);
                        weatherService.fetchWeatherData();
                    }
                    
                    // Show area info panel
                    const areaInfoPanel = document.getElementById('areaInfoPanel');
                    if (areaInfoPanel) {
                        areaInfoPanel.style.display = 'block';
                        document.getElementById('selectedAreaName').textContent = areaName;
                        
                        // Update risk level label
                        const riskLevel = document.getElementById('riskLevel');
                        if (riskLevel) {
                            riskLevel.textContent = area.riskLevel || 'Unknown';
                            
                            // Set color based on risk level
                            switch(area.riskLevel) {
                                case 'Very High':
                                case 'High':
                                    riskLevel.style.backgroundColor = '#FF0000';
                                    break;
                                case 'Medium':
                                    riskLevel.style.backgroundColor = '#FFAA00';
                                    break;
                                case 'Low':
                                    riskLevel.style.backgroundColor = '#00FF00';
                                    break;
                                default:
                                    riskLevel.style.backgroundColor = '#AAAAAA';
                            }
                        }
                        
                        // Update emergency contacts
                        updateEmergencyContacts(areaName);
                    }
                };
                
                // Function to handle alert button clicks
                window.viewAlertOnMap = function(button) {
                    const area = button.getAttribute('data-area');
                    if (!area) return;
                    
                    // Scroll to map section
                    document.getElementById('c_finance').scrollIntoView({ behavior: 'smooth' });
                    
                    // Update the area selector in the map section
                    const areaSelector = document.getElementById('areaSelector');
                    if (areaSelector) {
                        areaSelector.value = area;
                    }
                    
                    // Update the map with the selected area
                    window.updateSelectedArea(area);
                    
                    // Clear any existing temporary markers
                    if (window.tempMarker) {
                        window.mapInstance.removeLayer(window.tempMarker);
                    }
                    
                    // After a delay, highlight relevant facility based on the alert
                    setTimeout(() => {
                        highlightRelevantFacility(area);
                    }, 1000);
                };
                
                // Function to highlight a relevant facility for the current alert
                function highlightRelevantFacility(areaName) {
                    const area = areaData[areaName];
                    if (!area) return;
                    
                    // Show the facilities layer
                    window.showFacilities();
                    
                    let facilityToHighlight = null;
                    
                    // Choose appropriate facility based on risk level
                    if (area.riskLevel === "Very High" || area.riskLevel === "High") {
                        // For high risk, prioritize shelters
                        if (area.facilities) {
                            facilityToHighlight = area.facilities.find(f => f.type === "Shelter");
                        }
                        
                        // Fallback to medical facility
                        if (!facilityToHighlight && area.medicalFacilities && area.medicalFacilities.length > 0) {
                            facilityToHighlight = area.medicalFacilities[0];
                        }
                    } else if (area.riskLevel === "Medium") {
                        // For medium risk, show monitoring stations
                        if (area.facilities) {
                            facilityToHighlight = area.facilities.find(f => f.type === "Observation Point");
                        }
                        
                        // Fallback to any facility
                        if (!facilityToHighlight && area.facilities && area.facilities.length > 0) {
                            facilityToHighlight = area.facilities[0];
                        }
                    } else {
                        // For low risk, prioritize medical or police
                        if (area.medicalFacilities && area.medicalFacilities.length > 0) {
                            facilityToHighlight = area.medicalFacilities[0];
                        } else if (area.policeStations && area.policeStations.length > 0) {
                            facilityToHighlight = area.policeStations[0];
                        }
                    }
                    
                    // If we found a facility to highlight
                    if (facilityToHighlight) {
                        // Create a special marker that stands out
                        const highlightIcon = L.divIcon({
                            html: `<div style="background-color: #ff3333; width: 15px; height: 15px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.5);"></div>`,
                            className: 'highlight-marker',
                            iconSize: [22, 22],
                            iconAnchor: [11, 11]
                        });
                        
                        // Create marker and store it for later removal
                        window.tempMarker = L.marker([facilityToHighlight.lat, facilityToHighlight.lng], {
                            icon: highlightIcon,
                            zIndexOffset: 1000 // Make sure it's on top
                        }).addTo(window.mapInstance);
                        
                        // Create popup content
                        let popupContent = `
                            <div style="font-family: Arial, sans-serif; max-width: 300px;">
                                <h3 style="color: #006400; margin-bottom: 10px; border-bottom: 2px solid #006400; padding-bottom: 5px;">
                                    ${facilityToHighlight.name || 'Emergency Facility'}
                                </h3>
                                <p><strong>Type:</strong> ${facilityToHighlight.type || 'Emergency Facility'}</p>
                        `;
                        
                        // Add address if available
                        if (facilityToHighlight.address) {
                            popupContent += `<p><strong>Address:</strong> ${facilityToHighlight.address}</p>`;
                        }
                        
                        // Add phone if available
                        if (facilityToHighlight.phone) {
                            popupContent += `<p><strong>Phone:</strong> <a href="tel:${facilityToHighlight.phone}" style="color: #006400;">${facilityToHighlight.phone}</a></p>`;
                        }
                        
                        // Add emergency phone if available
                        if (facilityToHighlight.emergencyPhone) {
                            popupContent += `<p><strong>Emergency:</strong> <a href="tel:${facilityToHighlight.emergencyPhone}" style="color: #ff3333;">${facilityToHighlight.emergencyPhone}</a></p>`;
                        }
                        
                        // Add status if available
                        if (facilityToHighlight.status) {
                            popupContent += `<p><strong>Status:</strong> ${facilityToHighlight.status}</p>`;
                        }
                        
                        // Add services if available
                        if (facilityToHighlight.services) {
                            popupContent += `<p><strong>Services:</strong> ${facilityToHighlight.services}</p>`;
                        }
                        
                        // Add directions button
                        popupContent += `
                            <button onclick="window.open('https://www.google.com/maps/dir/?api=1&destination=${facilityToHighlight.lat},${facilityToHighlight.lng}', '_blank')" 
                                style="background: linear-gradient(to right, #006400, #00a000); color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; margin-top: 10px; width: 100%;">
                                Get Directions
                            </button>
                        </div>`;
                        
                        // Open popup immediately
                        window.tempMarker.bindPopup(popupContent).openPopup();
                        
                        // Zoom to facility
                        window.mapInstance.setView([facilityToHighlight.lat, facilityToHighlight.lng], 17);
                    }
                }
                
                // Function to update emergency contacts in the info panel
                function updateEmergencyContacts(areaName) {
                    const area = areaData[areaName];
                    if (!area) return;
                    
                    const emergencyContent = document.getElementById('emergency-content');
                    if (!emergencyContent) return;
                    
                    let html = '<ul style="list-style: none; padding: 0; margin: 0;">';
                    
                    // Add police stations
                    if (area.policeStations && area.policeStations.length > 0) {
                        area.policeStations.forEach(station => {
                            html += `
                                <li style="margin-bottom: 15px; background: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 5px;">
                                    <div style="font-weight: bold; color: white; margin-bottom: 5px;"> ${station.name}</div>
                                    <div style="color: #ccc; font-size: 0.9rem; margin-bottom: 5px;">${station.address}</div>
                                    <div style="display: flex; gap: 10px;">
                                        <a href="tel:${station.phone}" style="background: #006400; color: white; text-decoration: none; padding: 5px 10px; border-radius: 3px; font-size: 0.8rem;"> ${station.phone}</a>
                                        <a href="tel:${station.emergencyPhone}" style="background: #ff3333; color: white; text-decoration: none; padding: 5px 10px; border-radius: 3px; font-size: 0.8rem;"> ${station.emergencyPhone}</a>
                                    </div>
                                </li>
                            `;
                        });
                    }
                    
                    // Add fire stations
                    if (area.fireStations && area.fireStations.length > 0) {
                        area.fireStations.forEach(station => {
                            html += `
                                <li style="margin-bottom: 15px; background: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 5px;">
                                    <div style="font-weight: bold; color: white; margin-bottom: 5px;"> ${station.name}</div>
                                    <div style="color: #ccc; font-size: 0.9rem; margin-bottom: 5px;">${station.address}</div>
                                    <div style="display: flex; gap: 10px;">
                                        <a href="tel:${station.phone}" style="background: #006400; color: white; text-decoration: none; padding: 5px 10px; border-radius: 3px; font-size: 0.8rem;"> ${station.phone}</a>
                                        <a href="tel:${station.emergencyPhone}" style="background: #ff3333; color: white; text-decoration: none; padding: 5px 10px; border-radius: 3px; font-size: 0.8rem;"> ${station.emergencyPhone}</a>
                                    </div>
                                </li>
                            `;
                        });
                    }
                    
                    // Add medical facilities
                    if (area.medicalFacilities && area.medicalFacilities.length > 0) {
                        area.medicalFacilities.forEach(facility => {
                            html += `
                                <li style="margin-bottom: 15px; background: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 5px;">
                                    <div style="font-weight: bold; color: white; margin-bottom: 5px;"> ${facility.name}</div>
                                    <div style="color: #ccc; font-size: 0.9rem; margin-bottom: 5px;">${facility.address}</div>
                                    <div style="display: flex; gap: 10px;">
                                        <a href="tel:${facility.phone}" style="background: #006400; color: white; text-decoration: none; padding: 5px 10px; border-radius: 3px; font-size: 0.8rem;"> ${facility.phone}</a>
                                        <a href="tel:${facility.emergencyPhone}" style="background: #ff3333; color: white; text-decoration: none; padding: 5px 10px; border-radius: 3px; font-size: 0.8rem;"> ${facility.emergencyPhone}</a>
                                    </div>
                                </li>
                            `;
                        });
                    }
                    
                    html += '</ul>';
                    emergencyContent.innerHTML = html;
                }

                // Initialize with all areas in the selector
                const areaSelector = document.getElementById('areaSelector');
                areaSelector.innerHTML = '<option value="">Select Area</option>' +
                    Object.keys(areaData).map(area => 
                        `<option value="${area}">${area}</option>`
                    ).join('');

                // Add event listener for area selection
                areaSelector.addEventListener('change', function() {
                    window.updateSelectedArea(this.value);
                    // Update the resources section area selector as well
                    const resourcesAreaSelector = document.getElementById('resourcesAreaSelector');
                    if (resourcesAreaSelector) {
                        resourcesAreaSelector.value = this.value;
                    }
                });

                // Initialize with risk zones visible
                const facilitiesBtn = document.getElementById('facilitiesBtn');
                document.getElementById('riskZonesBtn').click();
                
                // Expose facilitiesBtn click handler for use in highlightFacilityOnMap
                window.showFacilities = function() {
                    const facilitiesBtn = document.getElementById('facilitiesBtn');
                    if (facilitiesBtn) {
                        facilitiesBtn.click();
                    }
                };
                
                
                // Add the existing event handlers for map buttons
                document.querySelectorAll('.map-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        document.querySelectorAll('.map-btn').forEach(b => b.style.background = '#333');
                        this.style.background = '#006400';
                        
                        // Toggle layers
                        const layers = {
                            'riskZonesBtn': riskZonesLayer,
                            'safeZonesBtn': safeZonesLayer,
                            'routesBtn': routesLayer,
                            'facilitiesBtn': window.facilitiesLayer,
                        };
                        
                        Object.entries(layers).forEach(([id, layer]) => {
                            if (this.id === id) {
                                layer.addTo(window.mapInstance);
                                // If weather button is clicked, fetch fresh weather data
                                if (id === 'weatherBtn') {
                                    weatherService.fetchWeatherData()
                                        .then(data => {
                                            // Weather data is updated via the 'weatherDataUpdated' event
                                        });
                                }
                            } else {
                                window.mapInstance.removeLayer(layer);
                            }
                        });
                    });
                });
            });
        </script>
    </section>

    <div class="section-spacer"></div>

 

    <section class="p_finance" id="p_finance" style="background-color: black;">

        <h1 class="heading">Natural Disasters around Klang</h1>
    </div>

    <!-- Enhanced Disaster Slider -->
    <div class="disaster-carousel-container">
        <div class="listing-carousel-button listing-carousel-button-next" aria-label="Next slide"><i class="fa fa-caret-right" aria-hidden="true"></i></div>
        <div class="listing-carousel-button listing-carousel-button-prev" aria-label="Previous slide"><i class="fa fa-caret-left" aria-hidden="true"></i></div>
        
        <div class="disaster-carousel">
                    <div class="swiper-container">
                <div class="swiper-wrapper" role="list">
                    <!-- Flood Card - Most relevant to Klang -->
                    <div class="swiper-slide" role="listitem">
                        <div class="disaster-card flood" tabindex="0">
                            <div class="disaster-icon">
                                <i class="fa fa-tint" aria-hidden="true"></i>
                            </div>
                            <div class="disaster-content">
                                <h3>Flooding <span class="risk-badge high">High Risk in Klang</span></h3>
                                
                                <div class="disaster-description">
                                    <p>Floods are Klang's most frequent natural disaster, often caused by heavy monsoon rainfall, coastal storm surges, and river overflow. Between 1998-2017, floods affected more than 2 billion people worldwide.</p>
                                    
                                    <div class="disaster-facts">
                                        <div class="fact">
                                            <span class="fact-number">70%</span>
                                            <span class="fact-text">of Klang's disasters are flood-related</span>
                        </div>
                                        <div class="fact">
                                            <span class="fact-number">3-5</span>
                                            <span class="fact-text">major flood events per decade</span>
                    </div>
                        </div>
                        
                                    <div class="warning-signs">
                                        <h4>Warning Signs</h4>
                                        <ul>
                                            <li>Continuous heavy rainfall for several hours</li>
                                            <li>Rising water levels in rivers and drains</li>
                                            <li>Weather alerts from Malaysian Meteorological Department</li>
                            </ul>
                                    </div>
                        </div>
                        
                                <div class="disaster-footer">
                                    <a href="#flood-preparedness" class="readiness-link" role="button">Flood Preparedness Guide</a>
                                    </div>
                        </div>
                    </div>
                </div>
                
                    <!-- Flash Flood Card -->
                    <div class="swiper-slide" role="listitem">
                        <div class="disaster-card flash-flood" tabindex="0">
                            <div class="disaster-icon">
                                <i class="fa fa-bolt" aria-hidden="true"></i><i class="fa fa-tint" aria-hidden="true"></i>
                </div>
                            <div class="disaster-content">
                                <h3>Flash Floods <span class="risk-badge high">High Risk in Klang</span></h3>
                                
                                <div class="disaster-description">
                                    <p>Flash floods occur rapidly with little warning, particularly in urban areas of Klang where concrete surfaces prevent water absorption. These events can transform streets into flowing rivers within minutes.</p>
                                    
                                    <div class="disaster-facts">
                                        <div class="fact">
                                            <span class="fact-number">15-30</span>
                                            <span class="fact-text">minutes to develop after heavy rain</span>
                                        </div>
                                        <div class="fact">
                                            <span class="fact-number">2x</span>
                                            <span class="fact-text">more frequent in recent years</span>
            </div>
        </div>
        
                                    <div class="warning-signs">
                                        <h4>High Risk Areas in Klang</h4>
                                        <ul>
                                            <li>Pelabuhan Klang coastal zones</li>
                                            <li>Bandar Sentosa</li>
                                            <li>Areas near Klang River</li>
                                        </ul>
                </div>
            </div>
                                
                                <div class="disaster-footer">
                                    <a href="#flash-flood-safety" class="readiness-link" role="button">Flash Flood Safety Tips</a>
        </div>
                                </div>
                            </div>
                    </div>

                    <!-- Landslide Card -->
                    <div class="swiper-slide" role="listitem">
                        <div class="disaster-card landslide" tabindex="0">
                            <div class="disaster-icon">
                                <i class="fa fa-arrow-down" aria-hidden="true"></i><i class="fa fa-map" aria-hidden="true"></i>
                            </div>
                            <div class="disaster-content">
                                <h3>Landslides <span class="risk-badge medium">Medium Risk in Klang</span></h3>
                                
                                <div class="disaster-description">
                                    <p>Landslides involve downslope movement of soil and rock under gravity's influence. In Klang, they typically occur in hilly areas during periods of heavy rainfall, particularly after prolonged wet seasons.</p>
                                    
                                    <div class="disaster-facts">
                                        <div class="fact">
                                            <span class="fact-number">3</span>
                                            <span class="fact-text">significant events in Klang since 2015</span>
                                        </div>
                                        <div class="fact">
                                            <span class="fact-number">24h</span>
                                            <span class="fact-text">of rain often triggers events</span>
                                        </div>
                                        </div>

                                    <div class="warning-signs">
                                        <h4>Warning Signs</h4>
                                        <ul>
                                            <li>Cracks appearing in hillsides</li>
                                            <li>Tilting trees or utility poles</li>
                                            <li>Sudden changes in water flow patterns</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="disaster-footer">
                                    <a href="#landslide-awareness" class="readiness-link" role="button">Landslide Awareness Guide</a>
                                    </div>
                            </div>
                                </div>
                            </div>

                    <!-- Thunderstorms Card -->
                    <div class="swiper-slide" role="listitem">
                        <div class="disaster-card thunderstorm" tabindex="0">
                            <div class="disaster-icon">
                                <i class="fa fa-bolt" aria-hidden="true"></i><i class="fa fa-cloud" aria-hidden="true"></i>
                            </div>
                            <div class="disaster-content">
                                <h3>Thunderstorms <span class="risk-badge medium">Medium Risk in Klang</span></h3>
                                
                                <div class="disaster-description">
                                    <p>Thunderstorms bring lightning, thunder, strong winds, and heavy rainfall. Klang's tropical climate makes it susceptible to powerful thunderstorms, especially during monsoon transition periods.</p>
                                    
                                    <div class="disaster-facts">
                                        <div class="fact">
                                            <span class="fact-number">200+</span>
                                            <span class="fact-text">thunderstorm days annually in Malaysia</span>
                                        </div>
                                        <div class="fact">
                                            <span class="fact-number">30</span>
                                            <span class="fact-text">minutes average duration</span>
                                        </div>
                                        </div>

                                    <div class="warning-signs">
                                        <h4>Safety Measures</h4>
                                        <ul>
                                            <li>Stay indoors during thunderstorms</li>
                                            <li>Avoid open areas and tall structures</li>
                                            <li>Unplug electronic devices</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="disaster-footer">
                                    <a href="#thunderstorm-safety" class="readiness-link" role="button">Thunderstorm Safety Guide</a>
                                    </div>
                                </div>
                            </div>
                    </div>

                    <!-- Coastal Erosion Card -->
                    <div class="swiper-slide" role="listitem">
                        <div class="disaster-card coastal-erosion" tabindex="0">
                            <div class="disaster-icon">
                                <i class="fa fa-water" aria-hidden="true"></i><i class="fa fa-long-arrow-right" aria-hidden="true"></i>
                        </div>
                            <div class="disaster-content">
                                <h3>Coastal Erosion <span class="risk-badge medium">Medium Risk in Klang</span></h3>
                                
                                <div class="disaster-description">
                                    <p>Coastal erosion is the gradual wearing away of land along shorelines, affecting Port Klang and other coastal communities. Rising sea levels and storm surges accelerate this process, threatening infrastructure.</p>
                                    
                                    <div class="disaster-facts">
                                        <div class="fact">
                                            <span class="fact-number">29%</span>
                                            <span class="fact-text">of Klang's coastline faces erosion risk</span>
</div>
                                        <div class="fact">
                                            <span class="fact-number">1-3m</span>
                                            <span class="fact-text">of coastline lost annually in critical areas</span>
                    </div>
                </div>

                                    <div class="warning-signs">
                                        <h4>Vulnerable Areas</h4>
                                        <ul>
                                            <li>Pelabuhan Klang shoreline</li>
                                            <li>Pulau Indah coastal regions</li>
                                            <li>Mouth of Klang River</li>
                                        </ul>
            </div>
                                </div>
                                
                                <div class="disaster-footer">
                                    <a href="#coastal-protection" class="readiness-link" role="button">Coastal Protection Information</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Earthquake Card (Less relevant but included for awareness) -->
                    <div class="swiper-slide" role="listitem">
                        <div class="disaster-card earthquake" tabindex="0">
                            <div class="disaster-icon">
                                <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                            </div>
                            <div class="disaster-content">
                                <h3>Earthquakes <span class="risk-badge low">Low Risk in Klang</span></h3>
                                
                                <div class="disaster-description">
                                    <p>While Malaysia is not on major fault lines, Klang can occasionally feel tremors from large earthquakes in neighboring Indonesia. The risk of direct earthquake damage in Klang is low, but awareness remains important.</p>
                                    
                                    <div class="disaster-facts">
                                        <div class="fact">
                                            <span class="fact-number">Rare</span>
                                            <span class="fact-text">occurrences affecting Klang directly</span>
                                        </div>
                                        <div class="fact">
                                            <span class="fact-number">&lt;4.0</span>
                                            <span class="fact-text">typical magnitude of felt tremors</span>
                                        </div>
                                    </div>
                                    
                                    <div class="warning-signs">
                                        <h4>Safety Tips</h4>
                                        <ul>
                                            <li>"Drop, Cover, and Hold On" during shaking</li>
                                            <li>Move away from windows and exterior walls</li>
                                            <li>Be prepared for aftershocks</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="disaster-footer">
                                    <a href="#earthquake-preparedness" class="readiness-link" role="button">Earthquake Safety Information</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tc-pagination" aria-label="Disaster cards pagination"></div>
        </div>
        </div> 

    <!-- Disaster Preparedness Quick Guide -->
    <div class="disaster-preparedness">
        <h2>Emergency Preparedness Guidance Videos</h2>
        <div class="video-cards-container">
            <div class="video-card" data-youtube-id="WtUYQZuZ4tU">
                <div class="video-thumbnail">
                    <img src="https://i.ytimg.com/vi/WtUYQZuZ4tU/hq720.jpg?sqp=-oaymwEnCNAFEJQDSFryq4qpAxkIARUAAIhCGAHYAQHiAQoIGBACGAY4AUAB&rs=AOn4CLB38oi22cwIpjjdjpuYvlWPzHKeLA" alt="Flood Safety Tips">
                    <div class="play-button"><i class="fa fa-play-circle"></i></div>
                    <div class="click-to-play-overlay">CLICK TO PLAY</div>
                    <div class="video-iframe-container"></div>
                </div>
                <div class="video-info">
                    <h4>Flood Safety Tips</h4>
                    <p>Learn essential safety measures to protect yourself and your family during flood events.</p>
                    <a href="https://www.youtube.com/watch?v=WtUYQZuZ4tU&pp=ygUbZmxvb2Qgc2FmZXR5IHRpcHMgZm9yIGtsYW5n" class="watch-video-btn" target="_blank">Watch Video</a>
                </div>
            </div>
            
            <div class="video-card" data-youtube-id="UmiGvOha7As">
                <div class="video-thumbnail">
                    <img src="https://i.ytimg.com/vi/UmiGvOha7As/hq720.jpg?sqp=-oaymwEnCNAFEJQDSFryq4qpAxkIARUAAIhCGAHYAQHiAQoIGBACGAY4AUAB&rs=AOn4CLBVVmO3L4ExqNgNZvh4k4ckPunCUA" alt="Emergency Kit Preparation">
                    <div class="play-button"><i class="fa fa-play-circle"></i></div>
                    <div class="click-to-play-overlay">CLICK TO PLAY</div>
                    <div class="video-iframe-container"></div>
                </div>
                <div class="video-info">
                    <h4>How to Prepare an Emergency Kit</h4>
                    <p>Step-by-step guide to creating a comprehensive emergency kit for natural disasters.</p>
                    <a href="https://www.youtube.com/watch?v=UmiGvOha7As&pp=ygUsaG93IHRvIHByZXBhcmUgZm9yIGFuIGVtZXJnZW5jeSBkaXNhc3RlciBraXQ%3D" class="watch-video-btn" target="_blank">Watch Video</a>
                </div>
            </div>
            
            <div class="video-card" data-youtube-id="C4aa9T5Fx5E">
                <div class="video-thumbnail">
                    <img src="https://i.ytimg.com/vi/C4aa9T5Fx5E/hq720.jpg?sqp=-oaymwEnCNAFEJQDSFryq4qpAxkIARUAAIhCGAHYAQHiAQoIGBACGAY4AUAB&rs=AOn4CLBlihhcZIsEg2ofXE-pWiDkG_n_-A" alt="Home Flood Prevention">
                    <div class="play-button"><i class="fa fa-play-circle"></i></div>
                    <div class="click-to-play-overlay">CLICK TO PLAY</div>
                    <div class="video-iframe-container"></div>
                </div>
                <div class="video-info">
                    <h4>Home Flood Prevention Techniques</h4>
                    <p>Practical methods to protect your home from flooding during monsoon season.</p>
                    <a href="https://www.youtube.com/watch?v=C4aa9T5Fx5E&pp=ygUgSG9tZSBGbG9vZCBQcmV2ZW50aW9uIFRlY2huaXF1ZXM%3D" class="watch-video-btn" target="_blank">Watch Video</a>
                </div>
            </div>

        </div>
    </div>
    </section>

<style>
/* Enhanced Natural Disasters Knowledge Area Styling */
.disaster-knowledge-section {
    background: linear-gradient(135deg, #121212 0%, #1c2d3b 100%);
    color: #fff;
    padding: 60px 20px;
    font-family: Arial, sans-serif;
}

.disaster-header {
    text-align: center;
    margin-bottom: 40px;
}

.disaster-header .heading {
    font-size: 2.5rem;
    margin-bottom: 10px;
    color: #fff;
    position: relative;
    display: inline-block;
}

.disaster-header .heading:after {
    content: "";
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 3px;
    background: linear-gradient(90deg, #006400, #00a000);
    border-radius: 3px;
}

.disaster-header .subheading {
    color: #ccc;
    font-size: 1.1rem;
}

/* Carousel Styling */
.disaster-carousel-container {
    position: relative;
    margin: 0 auto;
    max-width: 1200px;
    overflow: hidden;
}

.listing-carousel-button {
    position: absolute;
    top: 50%;
    width: 50px;
    height: 50px;
    line-height: 50px;
    margin-top: -25px;
    z-index: 10;
    cursor: pointer;
    background: #006400;
    border-radius: 50%;
    box-shadow: 0px 0px 0px 6px rgba(0, 100, 0, 0.2);
    text-align: center;
    transition: all 0.3s ease;
}

.listing-carousel-button:hover {
    background: #008000;
    box-shadow: 0px 0px 0px 10px rgba(0, 100, 0, 0.3);
}

.listing-carousel-button-next {
    right: 5px;
}

.listing-carousel-button-prev {
    left: 5px;
}

.disaster-carousel {
    padding: 10px 0;
}

/* Disaster Card Styling */
.disaster-card {
    background: rgba(30, 40, 50, 0.9);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    min-height: 580px;
    position: relative;
    transition: all 0.3s ease;
    border-top: 4px solid transparent;
}

.disaster-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
}

/* Add touch feedback styling for mobile devices */
.disaster-card.touch-active {
    transform: scale(0.98);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    transition: all 0.2s ease;
}

.disaster-card.flood { border-color: #00a0dc; }
.disaster-card.flash-flood { border-color: #0078d4; }
.disaster-card.landslide { border-color: #a35a00; }
.disaster-card.thunderstorm { border-color: #9e00e6; }
.disaster-card.earthquake { border-color: #e63900; }
.disaster-card.coastal-erosion { border-color: #00a0a0; }

.disaster-icon {
    padding: 25px 0;
    text-align: center;
    font-size: 32px;
}

.disaster-icon i {
    margin: 0 5px;
    color: #ff5900;
}

.disaster-content {
    padding: 0 25px 25px;
}

.disaster-content h3 {
    font-size: 1.6rem;
    margin-bottom: 20px;
    color: #fff;
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
}

.risk-badge {
    font-size: 0.7rem;
    padding: 4px 8px;
    border-radius: 12px;
    font-weight: normal;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.risk-badge.high { background-color: #ff0000; }
.risk-badge.medium { background-color: #ffa500; }
.risk-badge.low { background-color: #a3a337; color: #fff; }

.disaster-description p {
    line-height: 1.6;
    color: #ddd;
    margin-bottom: 20px;
}

.disaster-facts {
    display: flex;
    justify-content: space-between;
    margin: 25px 0;
    flex-wrap: wrap;
}

.fact {
    text-align: center;
    width: 48%;
    background: rgba(0, 0, 0, 0.2);
    padding: 15px 10px;
    border-radius: 8px;
    margin-bottom: 10px;
}

.fact-number {
    display: block;
    font-size: 1.8rem;
    font-weight: bold;
    color: #006400;
    margin-bottom: 5px;
}

.fact-text {
    font-size: 0.9rem;
    color: #ccc;
    line-height: 1.3;
}

.warning-signs {
    background: rgba(0, 100, 0, 0.1);
    border-left: 3px solid #006400;
    padding: 15px;
}

.warning-signs h4 {
    color: #00a000;
    margin-bottom: 10px;
    font-size: 1.1rem;
    position: relative;
    display: inline-block;
    padding-bottom: 5px;
}

.warning-signs h4::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, #006400, #00a000);
    border-radius: 2px;
}

.warning-signs ul {
    padding-left: 20px;
}

.warning-signs li {
    margin-bottom: 8px;
    color: #ddd;
    line-height: 1.4;
}

.disaster-footer {
    padding: 15px 0;
    text-align: center;
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.readiness-link {
    display: inline-block;
    padding: 8px 20px;
    background: #006400;
    color: #fff;
    border-radius: 30px;
    text-decoration: none;
    font-weight: bold;
    transition: all 0.3s ease;
}

.readiness-link:hover {
    background: #008000;
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0, 100, 0, 0.4);
}

/* Disaster Preparedness Section */
.disaster-preparedness {
    margin-top: 60px;
    background: rgba(0, 0, 0, 0.3);
    padding: 40px;
    border-radius: 12px;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
    width: 100%;
    box-sizing: border-box;
    overflow-x: hidden;
}

.disaster-preparedness h2 {
    text-align: center;
    margin-bottom: 30px;
    font-size: 1.8rem;
    color: #006400;
    width: 100%;
}

.preparedness-items {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 20px;
    width: 100%;
    box-sizing: border-box;
}

.prep-item {
    flex: 1;
    min-width: 220px;
    max-width: calc(25% - 15px);
    background: rgba(30, 40, 50, 0.8);
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    box-sizing: border-box;
}

@media (max-width: 991px) {
    .prep-item {
        max-width: calc(50% - 10px);
    }
}

@media (max-width: 576px) {
    .prep-item {
        max-width: 100%;
    }
    
    .disaster-preparedness {
        padding: 20px;
    }
}

.prep-icon {
    width: 50px;
    height: 50px;
    background: #006400;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 15px;
    font-size: 20px;
}

.prep-item h4 {
    margin-bottom: 15px;
    color: #fff;
}

.prep-item ul {
    padding-left: 20px;
}

.prep-item li {
    margin-bottom: 8px;
    color: #ddd;
    line-height: 1.4;
}

/* Swiper Customization */
.swiper-container {
    width: 100%;
    height: 100%;
}

.swiper-slide {
    opacity: 0.4;
    transform: scale(0.85);
    transition: all 0.3s ease;
}

.swiper-slide-active,
.swiper-slide-next,
.swiper-slide-prev {
    opacity: 1;
    transform: scale(1);
}

.tc-pagination {
    margin-top: 30px;
    text-align: center;
}

.swiper-pagination-bullet {
    width: 10px;
    height: 10px;
    display: inline-block;
    border-radius: 50%;
    background: #fff;
    opacity: 0.2;
    margin: 0 5px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.swiper-pagination-bullet-active {
    background: #006400;
    opacity: 1;
    transform: scale(1.5);
}

/* Media Queries */
@media screen and (max-width: 991px) {
    .listing-carousel-button-next {
        right: 0;
    }
    
    .listing-carousel-button-prev {
        left: 0;
    }
    
    .disaster-facts {
        flex-direction: column;
    }
    
    .fact {
        width: 100%;
        margin-bottom: 10px;
    }

    .disaster-card {
        min-height: 520px; /* Reduce height for tablets */
    }
}

@media screen and (max-width: 767px) {
    .disaster-header .heading {
        font-size: 2rem;
    }
    
    .preparedness-items {
        flex-direction: column;
    }
    
    .prep-item {
        width: 100%;
    }

    .disaster-card {
        min-height: 480px; /* Reduce height for mobile */
    }

    .disaster-content h3 {
        font-size: 1.4rem;
        flex-direction: column;
        align-items: flex-start;
    }

    .risk-badge {
        margin-top: 5px;
        display: inline-block;
    }

    .fact-number {
        font-size: 1.6rem;
    }

    .disaster-description p {
        font-size: 0.95rem;
    }

    .warning-signs h4 {
        font-size: 1rem;
    }

    .warning-signs li {
        font-size: 0.9rem;
    }

    /* Hide navigation buttons on mobile */
    .listing-carousel-button {
        display: none;
    }
}

/* iPad/Tablet Specific Optimizations */
@media only screen and (min-width: 768px) and (max-width: 1024px) {
    .swiper-container {
        padding: 0 10px;
    }
    
    .disaster-content {
        padding: 0 20px 20px;
    }
    
    .disaster-card {
        min-height: 500px;
    }
    
    .warning-signs {
        margin: 20px 0;
    }
    
    /* Improve touch targets for iPad */
    .readiness-link {
        padding: 10px 25px;
    }
    
    .listing-carousel-button {
        width: 40px;
        height: 40px;
        line-height: 40px;
        /* Position buttons inside the container so they don't cause overflow */
        top: 45%;
    }
    
    .listing-carousel-button-next {
        right: 5px;
    }
    
    .listing-carousel-button-prev {
        left: 5px;
    }
}

/* Small mobile devices */
@media screen and (max-width: 480px) {
    .disaster-carousel-container {
        margin: 0;
        overflow: hidden;
    }
    
    .disaster-card {
        min-height: 450px;
    }
    
    .disaster-icon {
        padding: 15px 0;
    }
    
    .disaster-content {
        padding: 0 15px 15px;
    }
    
    .disaster-facts {
        margin: 15px 0;
    }
    
    .fact {
        padding: 10px 5px;
    }
    
    .fact-number {
        font-size: 1.4rem;
    }
    
    .warning-signs {
        padding: 10px;
        margin: 15px 0;
    }
    
    .readiness-link {
        padding: 8px 15px;
        font-size: 0.9rem;
    }
}

/* Video Cards Styling */
.video-cards-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 20px;
    width: 100%;
}

.video-card {
    flex: 1;
    min-width: 280px;
    max-width: calc(25% - 15px);
    background: rgba(30, 40, 50, 0.8);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    position: relative;
}

.video-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
}

.video-thumbnail {
    position: relative;
    overflow: hidden;
    border-radius: 12px 12px 0 0;
    height: 180px;
}

.video-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.video-card:hover .video-thumbnail img {
    transform: scale(1.05);
}

.play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 50px;
    color: rgba(255, 255, 255, 0.8);
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
    opacity: 0.9;
    transition: all 0.3s ease;
    cursor: pointer;
    z-index: 2;
}

.video-card:hover .play-button {
    font-size: 55px;
    color: #fff;
    opacity: 1;
}

.video-iframe-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 180px;
    z-index: 1;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s;
}

.video-card:hover .video-iframe-container {
    opacity: 1;
    visibility: visible;
}

.video-info {
    padding: 20px;
}

.video-info h4 {
    font-size: 1.1rem;
    margin-bottom: 10px;
    color: #fff;
}

.video-info p {
    font-size: 0.9rem;
    color: #ccc;
    margin-bottom: 15px;
    line-height: 1.5;
}

.watch-video-btn {
    display: inline-block;
    padding: 8px 16px;
    background: #006400;
    color: #fff;
    text-decoration: none;
    border-radius: 30px;
    font-size: 0.9rem;
    font-weight: bold;
    transition: all 0.3s ease;
}

.watch-video-btn:hover {
    background: #008000;
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0, 100, 0, 0.4);
}

@media screen and (max-width: 991px) {
    .video-card {
        max-width: calc(50% - 10px);
    }
    .prep-item {
        max-width: calc(50% - 10px);
    }
}

@media screen and (max-width: 576px) {
    .video-card {
        max-width: 100%;
    }
    .disaster-preparedness {
        padding: 20px;
    }
    .prep-item {
        max-width: 100%;
    }
}
</style>

<script>
// Initialize Swiper when document is fully loaded
document.addEventListener('DOMContentLoaded', function() {
    const swiperOptions = {
        slidesPerView: 'auto',
        spaceBetween: 20,
        centeredSlides: true,
        loop: true,
        speed: 1000,
        mousewheel: false,
        pagination: {
            el: '.tc-pagination',
            clickable: true,
        },
        navigation: {
            nextEl: '.listing-carousel-button-next',
            prevEl: '.listing-carousel-button-prev',
        },
        breakpoints: {
            320: {
                slidesPerView: 1,
                spaceBetween: 10,
                centeredSlides: true
            },
            480: {
                slidesPerView: 1,
                spaceBetween: 15,
                centeredSlides: true
            },
            640: {
                slidesPerView: 1,
                spaceBetween: 20
            },
            768: {
                slidesPerView: 2,
                spaceBetween: 20
            },
            1024: {
                slidesPerView: 3,
                spaceBetween: 20
            }
        },
        // Add touch handling improvements
        touchRatio: 1.5,
        touchAngle: 45,
        grabCursor: true,
        touchEventsTarget: 'container',
        threshold: 5,
        touchStartPreventDefault: false
    };
    
    // Initialize swiper
    const swiper = new Swiper('.swiper-container', swiperOptions);
    
    // Add additional touch optimizations for mobile devices
    function isMobileDevice() {
        return (window.innerWidth <= 767 || 
                /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
    }
    
    // Optimize for mobile touch interactions
    if (isMobileDevice()) {
        // Make cards more finger-friendly
        const disasterCards = document.querySelectorAll('.disaster-card');
        
        disasterCards.forEach(card => {
            // Add active state for touch feedback
            card.addEventListener('touchstart', function(e) {
                this.classList.add('touch-active');
            }, { passive: true });
            
            card.addEventListener('touchend', function(e) {
                this.classList.remove('touch-active');
            }, { passive: true });
            
            // Improve anchor tap targets
            const links = card.querySelectorAll('a');
            links.forEach(link => {
                link.style.padding = '12px 25px';
            });
        });
        
        // Improve navigation buttons for touch
        const navButtons = document.querySelectorAll('.listing-carousel-button');
        navButtons.forEach(button => {
            // Make buttons larger on touch devices
            if (window.innerWidth <= 480) { // Small mobile
                button.style.width = '44px';
                button.style.height = '44px';
                button.style.lineHeight = '44px';
            }
        });
    }

    // YouTube Video Integration
    let players = {};
    let modalPlayer = null;
    let isAPIReady = false;
    let activeVideoId = null;
    let isCaptionsEnabled = false;

    // Get modal elements
    const videoModal = document.getElementById('video-modal');
    const modalTitle = document.getElementById('video-modal-title');
    const closeModalBtn = document.querySelector('.close-modal');
    const modalVideoContainer = document.getElementById('modal-video-container');
    const playbackSpeedSelect = document.getElementById('playback-speed-select');
    
    // Function called when YouTube API is ready
    window.onYouTubeIframeAPIReady = function() {
        isAPIReady = true;
        setupVideoCards();
    };

    function setupVideoCards() {
        const videoCards = document.querySelectorAll('.video-card');
        
        videoCards.forEach(card => {
            const videoId = card.getAttribute('data-youtube-id');
            const iframeContainer = card.querySelector('.video-iframe-container');
            const playButton = card.querySelector('.play-button');
            const clickToPlayOverlay = card.querySelector('.click-to-play-overlay');
            const thumbnail = card.querySelector('.video-thumbnail');
            const videoTitle = card.querySelector('h4').textContent;
            
            if (!videoId || !iframeContainer) return;
            
            // Make thumbnails keyboard accessible
            thumbnail.setAttribute('tabindex', '0');
            thumbnail.setAttribute('role', 'button');
            thumbnail.setAttribute('aria-label', `Play video: ${videoTitle}`);
            
            // Add keyboard support for opening the video
            thumbnail.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    openVideoModal(videoId, videoTitle);
                }
            });
            
            // Function to create and play YouTube video in hover preview
            function createAndPlayPreview() {
                if (!isAPIReady) return;
                
                // If player already exists for this card, just play it
                if (players[videoId]) {
                    players[videoId].playVideo();
                    return;
                }
                
                // Create a new player
                players[videoId] = new YT.Player(iframeContainer, {
                    height: '100%',
                    width: '100%',
                    videoId: videoId,
                    playerVars: {
                        'autoplay': 1,
                        'controls': 0,
                        'rel': 0,
                        'showinfo': 0,
                        'mute': 1, // Muted by default to comply with autoplay policies
                        'modestbranding': 1
                    },
                    events: {
                        'onReady': function(event) {
                            event.target.playVideo();
                        }
                    }
                });
            }
            
            // Function to stop preview video
            function stopAndRemovePreview() {
                if (players[videoId]) {
                    players[videoId].stopVideo();
                }
            }
            
            // Add event listeners for desktop hover preview
            card.addEventListener('mouseenter', function() {
                // Only show preview on hover if we're not on a touch device
                if (!isMobileDevice()) {
                    // Small delay to prevent accidental triggers
                    hoverTimeout = setTimeout(createAndPlayPreview, 500);
                }
            });
            
            card.addEventListener('mouseleave', function() {
                clearTimeout(hoverTimeout);
                stopAndRemovePreview();
            });
            
            // Open modal on click
            clickToPlayOverlay.addEventListener('click', function(e) {
                e.stopPropagation();
                openVideoModal(videoId, videoTitle);
            });
            
            // Handle clicks on the play button
            playButton.addEventListener('click', function(e) {
                e.stopPropagation();
                openVideoModal(videoId, videoTitle);
            });
            
            // Also make the whole thumbnail clickable
            thumbnail.addEventListener('click', function() {
                openVideoModal(videoId, videoTitle);
            });
        });
    }
    
    // Function to open video modal
    function openVideoModal(videoId, title) {
        if (!isAPIReady) return;
        
        activeVideoId = videoId;
        modalTitle.textContent = title;
        
        // Create the modal player
        modalPlayer = new YT.Player(modalVideoContainer, {
            height: '100%',
            width: '100%',
            videoId: videoId,
            playerVars: {
                'autoplay': 1,
                'controls': 1,
                'rel': 0,
                'modestbranding': 1,
                'enablejsapi': 1,
                'hl': 'en' // Set interface language to English
            },
            events: {
                'onReady': onModalPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
        
        // Show the modal with animation
        videoModal.style.display = 'block';
        setTimeout(() => {
            videoModal.classList.add('active');
        }, 10);
        
        // Set aria-hidden on the rest of the content for accessibility
        document.querySelector('main').setAttribute('aria-hidden', 'true');
        
        // Set focus to the modal for accessibility
        videoModal.setAttribute('tabindex', '-1');
        videoModal.focus();
        
        // Add event listener for escape key
        document.addEventListener('keydown', handleModalKeydown);
        
        // Prevent background scrolling
        document.body.style.overflow = 'hidden';
    }
    
    // Function to handle player state changes
    function onPlayerStateChange(event) {
        // You can add additional functionality here if needed
        // For example, automatically showing captions when the video starts
    }
    
    // Function called when the modal player is ready
    function onModalPlayerReady(event) {
        // Set up accessibility features
        
        // Set initial playback speed
        playbackSpeedSelect.value = '1';
    }
    
    // Function to close the video modal
    function closeVideoModal() {
        if (modalPlayer) {
            modalPlayer.stopVideo();
            modalPlayer.destroy();
            modalPlayer = null;
        }
        
        videoModal.classList.remove('active');
        
        // Hide the modal after animation completes
        setTimeout(() => {
            videoModal.style.display = 'none';
            // Clear the container
            modalVideoContainer.innerHTML = '';
        }, 300);
        
        // Reset aria-hidden
        document.querySelector('main').removeAttribute('aria-hidden');
        
        // Remove event listener for escape key
        document.removeEventListener('keydown', handleModalKeydown);
        
        // Restore background scrolling
        document.body.style.overflow = '';
    }
    
    // Function to handle keyboard events in the modal
    function handleModalKeydown(e) {
        if (e.key === 'Escape') {
            closeVideoModal();
        }
    }
    
    // Close modal when clicking the close button
    closeModalBtn.addEventListener('click', closeVideoModal);
    
    // Close modal when clicking outside the content
    videoModal.addEventListener('click', function(e) {
        if (e.target === videoModal) {
            closeVideoModal();
        }
    });
    
    // Change playback speed
    playbackSpeedSelect.addEventListener('change', function() {
        if (!modalPlayer) return;
        
        const speed = parseFloat(this.value);
        modalPlayer.setPlaybackRate(speed);
    });
    
    // If YouTube API is already loaded, set up the video cards
    if (typeof YT !== 'undefined' && typeof YT.Player !== 'undefined') {
        isAPIReady = true;
        setupVideoCards();
    }
});
</script>

    <div class="section-spacer"></div>

    <section class="g_finance" id="g_finance">
        <div class="history-container">
          <h1 class="history-heading">Historical Disaster Cases in Klang</h1>
          <div class="history-timeline">
            <div class="history-box">
              <div class="history-year">2022</div>
              <div class="history-content">
                <h3>Klang Valley Flash Floods</h3>
                <p>Major flash floods hit Klang in December 2022, affecting areas like Taman Sri Andalas and Bandar Puteri. Over 12,000 residents were evacuated to temporary relief centers as water levels rose significantly.</p>
                <a href="https://www.thestar.com.my/news/nation/2022/12/18/flash-floods-hit-klang-valley" class="source-link" target="_blank">
                  <span class="source-icon"></span> View Source
                </a>
              </div>
            </div>

            <div class="history-box">
              <div class="history-year">2021</div>
              <div class="history-content">
                <h3>Klang Monsoon Flooding</h3>
                <p>Severe flooding during the monsoon season affected multiple areas in Klang including Taman Berkeley and Bukit Raja. The disaster caused widespread damage to properties and infrastructure, with thousands displaced.</p>
                <a href="https://www.nst.com.my/news/nation/2021/12/754421/klang-valley-floods-among-worst-malaysias-history" class="source-link" target="_blank">
                  <span class="source-icon"></span> View Source
                </a>
              </div>
            </div>

            <div class="history-box">
              <div class="history-year">2017</div>
              <div class="history-content">
                <h3>Bandar Puteri Storm Surge</h3>
                <p>A significant storm surge hit Bandar Puteri area, causing flooding in coastal areas and disrupting port operations. The incident highlighted the vulnerability of coastal communities to extreme weather events.</p>
                <a href="https://www.theedgemarkets.com/article/port-klang-operations-disrupted-storm-surge-2017" class="source-link" target="_blank">
                  <span class="source-icon"></span> View Source
                </a>
              </div>
            </div>

            <div class="history-box">
              <div class="history-year">2016</div>
              <div class="history-content">
                <h3>Kapar Landslide</h3>
                <p>Heavy rains triggered a landslide in Kapar area, affecting several residential areas. The incident led to infrastructure damage and temporary evacuation of residents from affected areas.</p>
                <a href="https://www.malaymail.com/news/malaysia/2016/11/landslides-reported-in-kapar-following-heavy-rains" class="source-link" target="_blank">
                  <span class="source-icon"></span> View Source
                </a>
            </div>
        </div>

            <div class="history-box">
              <div class="history-year">2015</div>
              <div class="history-content">
                <h3>Klang River Overflow</h3>
                <p>Continuous heavy rainfall caused the Klang River to overflow its banks, affecting areas like Telok Gadong and Pandamaran. The incident highlighted the need for improved flood management systems.</p>
                <a href="https://www.bernama.com/en/general/news.php?id=1186542" class="source-link" target="_blank">
                  <span class="source-icon"></span> View Source
                </a>
              </div>
            </div>
          </div>
        </div>
    </section>

      <style>
      /* Historical Cases Styling */
      .g_finance {
        background-color: #000;
        color: white;
        padding: 60px 20px;
        position: relative;
        overflow: hidden;
      }
      
      .g_finance::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.8)), 
                    url('https://apicms.thestar.com.my/uploads/images/2024/02/06/2529887.JPG') center/cover;
        opacity: 0.5;
        z-index: 0;
      }
      
      .history-container {
        position: relative;
        z-index: 1;
        max-width: 1200px;
        margin: 0 auto;
      }
      
      .history-heading {
        text-align: center;
        font-size: 2.5rem;
        margin-bottom: 40px;
        color: #fff;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-shadow: 0 2px 5px rgba(0,0,0,0.5);
        position: relative;
      }
      
      .history-heading::after {
        content: "";
        display: block;
        width: 80px;
        height: 4px;
        background: #006400;
        margin: 15px auto;
        border-radius: 2px;
      }
      
      .history-timeline {
        position: relative;
        padding: 20px 0;
      }
      
      .history-timeline::before {
        content: "";
        position: absolute;
        top: 0;
        bottom: 0;
        left: 50%;
        width: 4px;
        background: rgba(0, 255, 34, 0.5);
        transform: translateX(-50%);
      }
      
      .history-box {
        display: flex;
        align-items: center;
        margin-bottom: 40px;
        position: relative;
        opacity: 0.9;
        transition: all 0.3s ease;
      }
      
      .history-box:hover {
        opacity: 1;
        transform: translateY(-5px);
      }
      
      .history-box:nth-child(odd) {
        flex-direction: row-reverse;
      }
      
      .history-year {
        min-width: 100px;
        height: 100px;
        background: #006400;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: bold;
        margin: 0 20px;
        color: #000;
        box-shadow: 0 0 15px hwb(0 100% 0% / 0.5);
        z-index: 2;
      }
      
      .history-content {
        width: calc(50% - 70px);
        background: rgba(40, 40, 40, 0.8);
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.302);
        border-left: 4px solid #006400;
        transition: all 0.3s ease;
      }
      
      .history-box:nth-child(odd) .history-content {
        border-left: none;
        border-right: 4px solid #006400;
      }
      
      .history-content h3 {
        color: #006400;
        margin-top: 0;
        font-size: 1.3rem;
      }
      
      .history-content p {
        color: #ccc;
        line-height: 1.6;
        margin-bottom: 15px;
      }
      
      .source-link {
        display: inline-flex;
        align-items: center;
        color: #fff;
        background: #006400;
        padding: 6px 12px;
        border-radius: 20px;
        text-decoration: none;
        font-size: 0.9rem;
        transition: all 0.3s ease;
      }
      
      .source-link:hover {
        background: #006400;
        transform: translateX(5px);
      }
      
      .source-icon {
        margin-right: 6px;
        font-size: 1rem;
      }
      
      /* Media Queries for Responsiveness */
      @media screen and (max-width: 900px) {
        .history-timeline::before {
          left: 30px;
        }
        
        .history-box, .history-box:nth-child(odd) {
          flex-direction: row;
        }
        
        .history-year {
          min-width: 60px;
          height: 60px;
          font-size: 1rem;
          margin: 0 15px 0 0;
          position: absolute;
          left: 0;
        }
        
        .history-content, .history-box:nth-child(odd) .history-content {
          width: calc(100% - 80px);
          margin-left: 80px;
          border-left: 4px solid #006400;
          border-right: none;
        }
      }
      
      @media screen and (max-width: 600px) {
        .history-heading {
          font-size: 1.8rem;
        }
        
        .history-content h3 {
          font-size: 1.1rem;
        }
        
        .history-content p {
          font-size: 0.9rem;
        }
      }
      </style>

    <section class="contribute" id="contribute" style="background-color: black; padding: 4rem 0;">
        <h1 class="heading" style="color: white; margin-bottom: 3rem;">Contribute</h1>

        <div class="contribute-container" style="display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap; max-width: 1600px; margin: 0 auto; padding: 0 2rem;">
            <!-- Report Card -->
            <div class="contribute-card" style="background: linear-gradient(145deg, #006400, #008000); border-radius: 15px; padding: 2rem; width: 300px; text-align: center; transition: transform 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: white; margin-bottom: 1rem;"></i>
                <h3 style="color: white; margin-bottom: 1rem;">Report</h3>
                <p style="color: white; margin-bottom: 2rem;">Help us track and respond to disasters by reporting incidents in your area. Your input helps save lives.</p>
                <a href="/surveyform" class="contribute-btn" target="_blank" rel="noopener noreferrer" style="display: inline-block; padding: 0.8rem 1.5rem; background-color: white; color: #006400; text-decoration: none; border-radius: 5px; font-weight: bold; transition: all 0.3s ease;">Report Now</a>
                        </div>

            <!-- Donate Card -->
            <div class="contribute-card" style="background: linear-gradient(145deg, #006400, #008000); border-radius: 15px; padding: 2rem; width: 300px; text-align: center; transition: transform 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                <i class="fas fa-hand-holding-heart" style="font-size: 3rem; color: white; margin-bottom: 1rem;"></i>
                <h3 style="color: white; margin-bottom: 1rem;">Donate</h3>
                <p style="color: white; margin-bottom: 2rem;">Support our Community Centres. Your donations help provide essential services to those in need.</p>
                <a href="/surveyform" class="contribute-btn" target="_blank" rel="noopener noreferrer" style="display: inline-block; padding: 0.8rem 1.5rem; background-color: white; color: #006400; text-decoration: none; border-radius: 5px; font-weight: bold; transition: all 0.3s ease;">Donate Now</a>
                    </div>

                        <!-- Volunteer Card -->
                        <div class="contribute-card" style="background: linear-gradient(145deg, #006400, #008000); border-radius: 15px; padding: 2rem; width: 300px; text-align: center; transition: transform 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                            <i class="fas fa-comments" style="font-size: 3rem; color: white; margin-bottom: 1rem;"></i>
                            <h3 style="color: white; margin-bottom: 1rem;">Volunteer</h3>
                            <p style="color: white; margin-bottom: 2rem;">Help the folks of Klang whenever and wherever needed. Lend us a hand with your time and skills.</p>
                            <a href="/surveyform" class="contribute-btn" target="_blank" rel="noopener noreferrer" style="display: inline-block; padding: 0.8rem 1.5rem; background-color: white; color: #006400; text-decoration: none; border-radius: 5px; font-weight: bold; transition: all 0.3s ease;">Help Now</a>
                </div>
                
            <!-- Feedback Card -->
            <div class="contribute-card" style="background: linear-gradient(145deg, #006400, #008000); border-radius: 15px; padding: 2rem; width: 300px; text-align: center; transition: transform 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                <i class="fas fa-comments" style="font-size: 3rem; color: white; margin-bottom: 1rem;"></i>
                <h3 style="color: white; margin-bottom: 1rem;">Feedback</h3>
                <p style="color: white; margin-bottom: 2rem;">Share your suggestions and help us improve our disaster response system for the community.</p>
                <a href="/surveyform" class="contribute-btn" target="_blank" rel="noopener noreferrer" style="display: inline-block; padding: 0.8rem 1.5rem; background-color: white; color: #006400; text-decoration: none; border-radius: 5px; font-weight: bold; transition: all 0.3s ease;">Give Feedback</a>
                    </div>
                    
                    </div>
                    
        <style>
            .contribute-card:hover {
                transform: translateY(-10px);
            }
            .contribute-btn:hover {
                background-color: #f0f0f0;
                transform: scale(1.05);
            }
            @media (max-width: 768px) {
                .contribute-container {
                    gap: 1rem;
                }
                .contribute-card {
                    width: 100%;
                    max-width: 300px;
                }
            }
        </style>
    </section>

    <footer class="footer">
        <p><span class="highlight">KDAH</span> - developed by <span class="highlight">Dashan Ghasan</span> - 2025</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery-js/1.4.0/js/lightgallery.min.js"></script>

    <script src="https://unpkg.com/swiper@7/swiper-bundle.min.js"></script>

    <!-- Loading Screen Handler - Must be first -->
    <script src="js/load-handler.js"></script>

    <!-- Loading Screen Handler -->
    <script src="js/main.js"></script>

    <!-- custom js file link  -->
    <script src="js/script.js"></script>

    <!-- Font Awesome for Icons -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <!-- Add the chatbot script reference -->
    <script src="/js/chatbot.js"></script>

    <!-- Add a listener to update popups when theme changes -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize existing code first
        // ... 
        
        // Add theme change listener
        const themeCheckbox = document.getElementById('checkbox');
        if (themeCheckbox) {
            themeCheckbox.addEventListener('change', function() {
                // When theme changes, close any open popups to ensure they're recreated with correct theme
                if (window.mapInstance) {
                    window.mapInstance.closePopup();
                }
            });
        }
        
        // Auto-hide navigation bar code
        const header = document.querySelector('.header');
        let lastScrollY = window.scrollY;
        let isScrolling = false;
        
        // Add the show trigger zone to the DOM
        const showTrigger = document.createElement('div');
        showTrigger.className = 'show-trigger';
        document.body.appendChild(showTrigger);
        
        // Function to hide the header
        function hideHeader() {
            if (window.scrollY > 100 && window.scrollY > lastScrollY) {
                header.classList.add('hidden');
            } else {
                header.classList.remove('hidden');
            }
            lastScrollY = window.scrollY;
            isScrolling = false;
        }
        
        // Scroll event
        window.addEventListener('scroll', () => {
            if (!isScrolling) {
                isScrolling = true;
                setTimeout(hideHeader, 100);
            }
        });
        
        // Mouse event for triggering header to appear
        showTrigger.addEventListener('mouseenter', () => {
            header.classList.remove('hidden');
        });
    });
    </script>

    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Add JavaScript for the News Alerts functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Alert slider functionality
            const alertItems = document.querySelectorAll('.alert-item');
            const indicators = document.querySelectorAll('.indicator');
            const prevBtn = document.querySelector('.alert-control-btn.prev');
            const nextBtn = document.querySelector('.alert-control-btn.next');
            let currentIndex = 0;
            let autoRotateInterval;
            
            function showAlert(index) {
                // Remove active class from all items
                alertItems.forEach(item => item.classList.remove('active'));
                indicators.forEach(ind => ind.classList.remove('active'));
                
                // Add active class to current item
                alertItems[index].classList.add('active');
                indicators[index].classList.add('active');
                currentIndex = index;
            }
            
            // Next button click
            nextBtn.addEventListener('click', function() {
                // Clear the auto-rotation interval when user manually changes
                clearInterval(autoRotateInterval);
                const newIndex = (currentIndex + 1) % alertItems.length;
                showAlert(newIndex);
                // Restart the auto-rotation
                startAutoRotate();
            });
            
            // Previous button click
            prevBtn.addEventListener('click', function() {
                // Clear the auto-rotation interval when user manually changes
                clearInterval(autoRotateInterval);
                const newIndex = (currentIndex - 1 + alertItems.length) % alertItems.length;
                showAlert(newIndex);
                // Restart the auto-rotation
                startAutoRotate();
            });
            
            // Indicator clicks
            indicators.forEach((indicator, index) => {
                indicator.addEventListener('click', function() {
                    // Clear the auto-rotation interval when user manually changes
                    clearInterval(autoRotateInterval);
                    showAlert(index);
                    // Restart the auto-rotation
                    startAutoRotate();
                });
            });
            
            // Function to start auto-rotate
            function startAutoRotate() {
                // Clear any existing interval
                clearInterval(autoRotateInterval);
                // Set a new interval
                autoRotateInterval = setInterval(function() {
                    const newIndex = (currentIndex + 1) % alertItems.length;
                    showAlert(newIndex);
                }, 10000); // Every 10 seconds
            }
            
            // Initialize auto-rotate with a delay
            setTimeout(function() {
                startAutoRotate();
            }, 1500); // Start rotation after 1.5 seconds
            
            // Function to handle alert-to-map interaction (defined globally)
            window.viewAlertOnMap = function(button) {
                // Get the area data attribute from the button
                const area = button.getAttribute('data-area');
                if (!area) return;
                
                // Scroll to map section
                document.getElementById('c_finance').scrollIntoView({ behavior: 'smooth' });
                
                // Update the area selector in the map section
                const areaSelector = document.getElementById('areaSelector');
                if (areaSelector) {
                    areaSelector.value = area;
                    
                    // Trigger change event to update the map
                    const event = new Event('change');
                    areaSelector.dispatchEvent(event);
                } else {
                    // Fallback if the areaSelector isn't found
                    updateSelectedArea(area);
                }
                
                // Show specific popup based on area after a delay to ensure map is loaded
                setTimeout(() => {
                    // Try to find a relevant facility to highlight based on the alert
                    showRelevantFacility(area);
                }, 1500);
            };
        });
        
        // Function to show relevant facility for an area
        function showRelevantFacility(area) {
            if (!window.mapInstance || !window.areaData || !window.areaData[area]) return;
            
            const areaInfo = window.areaData[area];
            
            // Different handling based on risk level
            let facilityToShow;
            
            if (areaInfo.riskLevel === "Very High" || areaInfo.riskLevel === "High") {
                // For high risk areas, prioritize evacuation centers
                facilityToShow = findFacilityByType(areaInfo, "Shelter");
                
                // If no shelter found, show a medical facility
                if (!facilityToShow && areaInfo.medicalFacilities && areaInfo.medicalFacilities.length > 0) {
                    facilityToShow = areaInfo.medicalFacilities[0];
                    facilityToShow.type = "Medical";
                }
            } else if (areaInfo.riskLevel === "Medium") {
                // For medium risk, show monitoring stations if available
                facilityToShow = findFacilityByType(areaInfo, "Observation Point");
                
                // Fallback to any available facility
                if (!facilityToShow && areaInfo.facilities && areaInfo.facilities.length > 0) {
                    facilityToShow = areaInfo.facilities[0];
                }
            } else {
                // For low risk, show medical facilities or police stations
                if (areaInfo.medicalFacilities && areaInfo.medicalFacilities.length > 0) {
                    facilityToShow = areaInfo.medicalFacilities[0];
                    facilityToShow.type = "Medical";
                } else if (areaInfo.policeStations && areaInfo.policeStations.length > 0) {
                    facilityToShow = areaInfo.policeStations[0];
                    facilityToShow.type = "Police";
                }
            }
            
            // If we found a facility to highlight
            if (facilityToShow) {
                // Set view to the facility location
                window.mapInstance.setView([facilityToShow.lat, facilityToShow.lng], 17);
                
                // Create a marker with popup for the facility
                const marker = L.marker([facilityToShow.lat, facilityToShow.lng])
                    .addTo(window.mapInstance);
                    
                // Create popup content based on facility type
                let popupContent = createFacilityPopup(facilityToShow);
                
                // Open the popup immediately
                marker.bindPopup(popupContent).openPopup();
                
                // Store the marker to remove it later
                window.tempMarker = marker;
            } else {
                // Default to center of the area if no specific facility found
                window.mapInstance.setView(areaInfo.center, areaInfo.zoom);
            }
        }
        
        // Helper function to find facility by type
        function findFacilityByType(areaInfo, type) {
            if (areaInfo.facilities && areaInfo.facilities.length > 0) {
                return areaInfo.facilities.find(f => f.type === type);
            }
            return null;
        }
        
        // Function to create a popup for a facility
        function createFacilityPopup(facility) {
            // Base styling
            const styles = {
                container: 'background-color: rgba(0,0,0,0.8); color: white; border-radius: 8px; padding: 15px; max-width: 300px;',
                header: 'font-size: 16px; font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #006400; padding-bottom: 8px;',
                infoRow: 'margin: 8px 0;',
                label: 'color: #00a000; font-weight: bold; margin-right: 5px;',
                button: 'background: linear-gradient(90deg, #006400, #00a000); border: none; color: white; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin-top: 10px; width: 100%;'
            };
            
            // Create header based on facility type
            let title = facility.name || 'Emergency Facility';
            let icon = '';
            
            switch(facility.type) {
                case 'Shelter':
                    icon = '';
                    break;
                case 'Medical':
                    icon = '';
                    break;
                case 'Police':
                    icon = '';
                    break;
                case 'Observation Point':
                    icon = '';
                    break;
                case 'Relief Center':
                    icon = '';
                    break;
            }
            
            // Build popup HTML
            let html = `<div style="${styles.container}">`;
            html += `<div style="${styles.header}">${icon} ${title}</div>`;
            
            // Add type if available
            if (facility.type) {
                html += `<div style="${styles.infoRow}"><span style="${styles.label}">Type:</span> ${facility.type}</div>`;
            }
            
            // Add address if available
            if (facility.address) {
                html += `<div style="${styles.infoRow}"><span style="${styles.label}">Address:</span> ${facility.address}</div>`;
            }
            
            // Add phone if available
            if (facility.phone) {
                html += `<div style="${styles.infoRow}"><span style="${styles.label}">Phone:</span> <a href="tel:${facility.phone}" style="color: #3399ff;">${facility.phone}</a></div>`;
            }
            
            // Add emergency phone if available and different from regular phone
            if (facility.emergencyPhone && facility.emergencyPhone !== facility.phone) {
                html += `<div style="${styles.infoRow}"><span style="${styles.label}">Emergency:</span> <a href="tel:${facility.emergencyPhone}" style="color: #ff3333;">${facility.emergencyPhone}</a></div>`;
            }
            
            // Add status if available
            if (facility.status) {
                let statusColor = '#00ff00'; // Green for operational
                if (facility.status.includes('Limited')) {
                    statusColor = '#ffaa00'; // Orange for limited
                } else if (facility.status.includes('Closed') || facility.status.includes('Not')) {
                    statusColor = '#ff3333'; // Red for closed or not operational
                }
                
                html += `<div style="${styles.infoRow}"><span style="${styles.label}">Status:</span> <span style="color: ${statusColor};">${facility.status}</span></div>`;
            }
            
            // Add services if available
            if (facility.services) {
                html += `<div style="${styles.infoRow}"><span style="${styles.label}">Services:</span> ${facility.services}</div>`;
            }
            
            // Add a button for directions
            html += `<button onclick="window.open('https://www.google.com/maps/dir/?api=1&destination=${facility.lat},${facility.lng}', '_blank')" style="${styles.button}">Get Directions</button>`;
            
            html += '</div>';
            
            return html;
        }
    </script>

    <!-- Video Modal for Accessible Player -->
    <div id="video-modal" class="video-modal">
        <div class="video-modal-content">
            <div class="video-modal-header">
                <h3 id="video-modal-title">Video Title</h3>
                <button class="close-modal" aria-label="Close video"></button>
                    </div>
            <div class="video-modal-body">
                <div id="modal-video-container"></div>
                </div>
            <div class="video-modal-footer">
                <div class="accessibility-controls">
                    <div class="playback-speed">
                        <label for="playback-speed-select">Speed:</label>
                        <select id="playback-speed-select" aria-label="Playback speed">
                            <option value="0.5">0.5x</option>
                            <option value="0.75">0.75x</option>
                            <option value="1" selected>1x</option>
                            <option value="1.25">1.25x</option>
                            <option value="1.5">1.5x</option>
                            <option value="2">2x</option>
                        </select>
            </div>
            </div>
        </div>
    </div>
            </div>

<!-- Lenis Smooth Scrolling (CDN) -->
<script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>

<!-- GSAP for scroll-triggered animations (optional but recommended) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

<!-- Lenis initialization script -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize Lenis smooth scrolling with enhanced options
        const lenis = new Lenis({
            duration: 1.2,
            easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
            direction: 'vertical',
            gestureDirection: 'vertical',
            smooth: true,
            smoothTouch: false,    // Disable on touch devices for better performance
            touchMultiplier: 2,
            wheelMultiplier: 1,    // Adjust wheel sensitivity
            lerp: 0.1,             // Lower values make scrolling smoother but less responsive
            infinite: false,       // Set to true for infinite scrolling pages
            orientation: 'vertical', // 'vertical' or 'horizontal'
            normalizeWheel: true,   // Normalizes wheel inputs across browsers
            smoothWheel: true      // Smooth mouse wheel scrolling
        });

        // Get scroll value for debugging or custom effects
        lenis.on('scroll', ({ scroll, limit, velocity, direction, progress }) => {
            // console.log({ scroll, limit, velocity, direction, progress });
            
            // You can use these values to trigger animations based on scroll position
            // Example: update a progress bar
            // document.querySelector('.progress-bar').style.width = `${progress * 100}%`;
        });

        // GSAP ScrollTrigger integration (if using GSAP)
        if (window.ScrollTrigger) {
            lenis.on('scroll', ScrollTrigger.update);
            
            gsap.ticker.add((time) => {
                lenis.raf(time * 1000);
            });
            
            gsap.ticker.lagSmoothing(0);
        } else {
            // Use requestAnimationFrame loop for smooth scrolling if not using GSAP
            function raf(time) {
                lenis.raf(time);
                requestAnimationFrame(raf);
            }
            requestAnimationFrame(raf);
        }

        // Handle anchor links for smooth scrolling to sections
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    // Scroll to the element
                    lenis.scrollTo(targetElement, {
                        offset: 0, // Adjust if you have fixed headers
                        immediate: false,
                        duration: 1.2,
                        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t))
                    });
                }
            });
        });

        // Handle browser back/forward navigation
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }
        
        // Handle keyboard navigation (arrow keys, Page Up/Down, Home/End)
        window.addEventListener('keydown', (e) => {
            // Skip if typing in form elements
            if (['INPUT', 'TEXTAREA', 'SELECT'].includes(document.activeElement.tagName)) return;
            
            const currentPos = lenis.scroll;
            const scrollAmount = window.innerHeight * 0.9;
            
            switch (e.key) {
                case 'ArrowDown':
                case 'PageDown':
                    lenis.scrollTo(currentPos + scrollAmount);
                    e.preventDefault();
                    break;
                case 'ArrowUp':
                case 'PageUp':
                    lenis.scrollTo(currentPos - scrollAmount);
                    e.preventDefault();
                    break;
                case 'Home':
                    lenis.scrollTo(0);
                    e.preventDefault();
                    break;
                case 'End':
                    lenis.scrollTo(document.body.scrollHeight);
                    e.preventDefault();
                    break;
            }
        });

        // Optimize performance for mobile devices
        const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        if (isMobile) {
            lenis.options.lerp = 0.15; // Slightly faster response for mobile
            lenis.options.duration = 1; // Shorter animation time on mobile
        }

        // Handle resize events to recalculate dimensions
        window.addEventListener('resize', () => {
            lenis.resize();
        });

        // Stop scrolling when tab/window is not visible for performance
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                lenis.stop();
            } else {
                lenis.start();
            }
        });
    });
</script>
    
</body>

</html>
